<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: OrigenARMDebug::JTAG_DPController
  
    &mdash; Origen ARM Debug 1.2.0
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "OrigenARMDebug::JTAG_DPController";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (J)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../OrigenARMDebug.html" title="OrigenARMDebug (module)">OrigenARMDebug</a></span></span>
     &raquo; 
    <span class="title">JTAG_DPController</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: OrigenARMDebug::JTAG_DPController
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">OrigenARMDebug::JTAG_DPController</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  <dl>
      <dt>Includes:</dt>
      <dd>Origen::Controller, <span class='object_link'><a href="DPController.html" title="OrigenARMDebug::DPController (module)">DPController</a></span>, <span class='object_link'><a href="Helpers.html" title="OrigenARMDebug::Helpers (module)">Helpers</a></span></dd>
  </dl>
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/origen_arm_debug/jtag_dp_controller.rb</dd>
  </dl>
  
</div>








  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#base_address-instance_method" title="#base_address (instance method)">#<strong>base_address</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#read_register-instance_method" title="#read_register (instance method)">#<strong>read_register</strong>(reg, options = {})  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#write_register-instance_method" title="#write_register (instance method)">#<strong>write_register</strong>(reg, options = {})  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="DPController.html" title="OrigenARMDebug::DPController (module)">DPController</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="DPController.html#ctrl_stat-instance_method" title="OrigenARMDebug::DPController#ctrl_stat (method)">#ctrl_stat</a></span>, <span class='object_link'><a href="DPController.html#select_ap_reg-instance_method" title="OrigenARMDebug::DPController#select_ap_reg (method)">#select_ap_reg</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Helpers.html" title="OrigenARMDebug::Helpers (module)">Helpers</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Helpers.html#extract_address-instance_method" title="OrigenARMDebug::Helpers#extract_address (method)">#extract_address</a></span>, <span class='object_link'><a href="Helpers.html#extract_data-instance_method" title="OrigenARMDebug::Helpers#extract_data (method)">#extract_data</a></span>, <span class='object_link'><a href="Helpers.html#log-instance_method" title="OrigenARMDebug::Helpers#log (method)">#log</a></span></p>

  

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="base_address-instance_method">
  
    #<strong>base_address</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


141
142
143</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/origen_arm_debug/jtag_dp_controller.rb', line 141</span>

<span class='kw'>def</span> <span class='id identifier rubyid_base_address'>base_address</span>
  <span class='id identifier rubyid_model'>model</span><span class='period'>.</span><span class='id identifier rubyid_base_address'>base_address</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="read_register-instance_method">
  
    #<strong>read_register</strong>(reg, options = {})  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/origen_arm_debug/jtag_dp_controller.rb', line 63</span>

<span class='kw'>def</span> <span class='id identifier rubyid_read_register'>read_register</span><span class='lparen'>(</span><span class='id identifier rubyid_reg'>reg</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>unless</span> <span class='id identifier rubyid_reg'>reg</span><span class='period'>.</span><span class='id identifier rubyid_readable?'>readable?</span>
    <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The :</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_reg'>reg</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> register is not readable!</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_reg'>reg</span><span class='period'>.</span><span class='id identifier rubyid_owner'>owner</span> <span class='op'>==</span> <span class='id identifier rubyid_model'>model</span>
    <span class='comment'># Don&#39;t log this one, not really a DP reg and will be included
</span>    <span class='comment'># in the JTAG driver log anyway
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_reg'>reg</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>==</span> <span class='symbol'>:ir</span>
      <span class='id identifier rubyid_dut'>dut</span><span class='period'>.</span><span class='id identifier rubyid_jtag'>jtag</span><span class='period'>.</span><span class='id identifier rubyid_read_ir'>read_ir</span><span class='lparen'>(</span><span class='id identifier rubyid_reg'>reg</span><span class='rparen'>)</span>
    <span class='kw'>else</span>

      <span class='id identifier rubyid_log'>log</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Read JTAG-DP register </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_reg'>reg</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_upcase'>upcase</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='const'>Origen</span><span class='op'>::</span><span class='const'>Utility</span><span class='period'>.</span><span class='id identifier rubyid_read_hex'>read_hex</span><span class='lparen'>(</span><span class='id identifier rubyid_reg'>reg</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_reg'>reg</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>==</span> <span class='symbol'>:idcode</span>
          <span class='id identifier rubyid_ir'>ir</span><span class='period'>.</span><span class='id identifier rubyid_write!'>write!</span><span class='lparen'>(</span><span class='id identifier rubyid_reg'>reg</span><span class='period'>.</span><span class='id identifier rubyid_offset'>offset</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_dut'>dut</span><span class='period'>.</span><span class='id identifier rubyid_jtag'>jtag</span><span class='period'>.</span><span class='id identifier rubyid_read_dr'>read_dr</span><span class='lparen'>(</span><span class='id identifier rubyid_reg'>reg</span><span class='rparen'>)</span>

        <span class='comment'># DPACC
</span>        <span class='kw'>elsif</span> <span class='id identifier rubyid_reg'>reg</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>==</span> <span class='symbol'>:ctrlstat</span> <span class='op'>||</span> <span class='id identifier rubyid_reg'>reg</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>==</span> <span class='symbol'>:select</span> <span class='op'>||</span> <span class='id identifier rubyid_reg'>reg</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>==</span> <span class='symbol'>:rdbuff</span>

          <span class='comment'># Part 1 - Request read from DP-Register by writing to DPACC with RnW=1
</span>          <span class='id identifier rubyid_dr'>dr</span><span class='period'>.</span><span class='id identifier rubyid_reset'>reset</span>
          <span class='id identifier rubyid_dr'>dr</span><span class='period'>.</span><span class='id identifier rubyid_overlay'>overlay</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_dr'>dr</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_dr'>dr</span><span class='lbracket'>[</span><span class='int'>2</span><span class='op'>..</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='id identifier rubyid_reg'>reg</span><span class='period'>.</span><span class='id identifier rubyid_offset'>offset</span> <span class='op'>&gt;&gt;</span> <span class='int'>2</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_dr'>dr</span><span class='lbracket'>[</span><span class='int'>34</span><span class='op'>..</span><span class='int'>3</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_ir'>ir</span><span class='period'>.</span><span class='id identifier rubyid_write!'>write!</span><span class='lparen'>(</span><span class='id identifier rubyid_dpacc_select'>dpacc_select</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_dut'>dut</span><span class='period'>.</span><span class='id identifier rubyid_jtag'>jtag</span><span class='period'>.</span><span class='id identifier rubyid_write_dr'>write_dr</span><span class='lparen'>(</span><span class='id identifier rubyid_dr'>dr</span><span class='rparen'>)</span>

          <span class='comment'># Part 2 - Now read real data from RDBUFF (DP-Reg)
</span>          <span class='id identifier rubyid_dr'>dr</span><span class='period'>.</span><span class='id identifier rubyid_reset'>reset</span>
          <span class='id identifier rubyid_dr'>dr</span><span class='period'>.</span><span class='id identifier rubyid_overlay'>overlay</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_dr'>dr</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_dr'>dr</span><span class='lbracket'>[</span><span class='int'>2</span><span class='op'>..</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='id identifier rubyid_rdbuff'>rdbuff</span><span class='period'>.</span><span class='id identifier rubyid_offset'>offset</span> <span class='op'>&gt;&gt;</span> <span class='int'>2</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_dr'>dr</span><span class='lbracket'>[</span><span class='int'>34</span><span class='op'>..</span><span class='int'>3</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_copy_all'>copy_all</span><span class='lparen'>(</span><span class='id identifier rubyid_reg'>reg</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:mask</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:mask</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='int'>3</span> <span class='kw'>unless</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:mask</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
          <span class='id identifier rubyid_dut'>dut</span><span class='period'>.</span><span class='id identifier rubyid_jtag'>jtag</span><span class='period'>.</span><span class='id identifier rubyid_read_dr'>read_dr</span><span class='lparen'>(</span><span class='id identifier rubyid_dr'>dr</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>

        <span class='kw'>else</span>
          <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Can&#39;t read </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_reg'>reg</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='comment'># AP register read
</span>  <span class='kw'>else</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_reg'>reg</span><span class='period'>.</span><span class='id identifier rubyid_owner'>owner</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="AP.html" title="OrigenARMDebug::AP (class)">AP</a></span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>The JTAG-DP can only write to DP or AP registers!</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>end</span>

    <span class='comment'># Part 1 - Request read from AP-Register by writing to APACC with RnW=1
</span>    <span class='id identifier rubyid_select_ap_reg'>select_ap_reg</span><span class='lparen'>(</span><span class='id identifier rubyid_reg'>reg</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_dr'>dr</span><span class='period'>.</span><span class='id identifier rubyid_reset'>reset</span>
    <span class='id identifier rubyid_dr'>dr</span><span class='period'>.</span><span class='id identifier rubyid_overlay'>overlay</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_dr'>dr</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_dr'>dr</span><span class='lbracket'>[</span><span class='int'>2</span><span class='op'>..</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='id identifier rubyid_reg'>reg</span><span class='period'>.</span><span class='id identifier rubyid_offset'>offset</span> <span class='op'>&gt;&gt;</span> <span class='int'>2</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_dr'>dr</span><span class='lbracket'>[</span><span class='int'>34</span><span class='op'>..</span><span class='int'>3</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_ir'>ir</span><span class='period'>.</span><span class='id identifier rubyid_write!'>write!</span><span class='lparen'>(</span><span class='id identifier rubyid_apacc_select'>apacc_select</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_dut'>dut</span><span class='period'>.</span><span class='id identifier rubyid_jtag'>jtag</span><span class='period'>.</span><span class='id identifier rubyid_write_dr'>write_dr</span><span class='lparen'>(</span><span class='id identifier rubyid_dr'>dr</span><span class='rparen'>)</span>

    <span class='comment'># Calling AP should provide any delay parameter for wait states between AP read request
</span>    <span class='comment'>#   and when the data is available at the RDBUFF DP-Reg
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:apacc_wait_states</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:apacc_wait_states</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_cycles'>cycles</span>
    <span class='kw'>end</span>

    <span class='comment'># Part 2 - Now read real data from RDBUFF (DP-Reg)
</span>    <span class='id identifier rubyid_dr'>dr</span><span class='period'>.</span><span class='id identifier rubyid_reset'>reset</span>
    <span class='id identifier rubyid_dr'>dr</span><span class='period'>.</span><span class='id identifier rubyid_overlay'>overlay</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_dr'>dr</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_dr'>dr</span><span class='lbracket'>[</span><span class='int'>2</span><span class='op'>..</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='id identifier rubyid_rdbuff'>rdbuff</span><span class='period'>.</span><span class='id identifier rubyid_offset'>offset</span> <span class='op'>&gt;&gt;</span> <span class='int'>2</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_dr'>dr</span><span class='lbracket'>[</span><span class='int'>34</span><span class='op'>..</span><span class='int'>3</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_copy_all'>copy_all</span><span class='lparen'>(</span><span class='id identifier rubyid_reg'>reg</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:mask</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:mask</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='int'>3</span> <span class='kw'>unless</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:mask</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_ir'>ir</span><span class='period'>.</span><span class='id identifier rubyid_write!'>write!</span><span class='lparen'>(</span><span class='id identifier rubyid_dpacc_select'>dpacc_select</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_dut'>dut</span><span class='period'>.</span><span class='id identifier rubyid_jtag'>jtag</span><span class='period'>.</span><span class='id identifier rubyid_read_dr'>read_dr</span><span class='lparen'>(</span><span class='id identifier rubyid_dr'>dr</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="write_register-instance_method">
  
    #<strong>write_register</strong>(reg, options = {})  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/origen_arm_debug/jtag_dp_controller.rb', line 7</span>

<span class='kw'>def</span> <span class='id identifier rubyid_write_register'>write_register</span><span class='lparen'>(</span><span class='id identifier rubyid_reg'>reg</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>unless</span> <span class='id identifier rubyid_reg'>reg</span><span class='period'>.</span><span class='id identifier rubyid_writable?'>writable?</span>
    <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The :</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_reg'>reg</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> register is not writeable!</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'># DP register write
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_reg'>reg</span><span class='period'>.</span><span class='id identifier rubyid_owner'>owner</span> <span class='op'>==</span> <span class='id identifier rubyid_model'>model</span>
    <span class='comment'># Don&#39;t log this one, not really a DP reg and will be included
</span>    <span class='comment'># in the JTAG driver log anyway
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_reg'>reg</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>==</span> <span class='symbol'>:ir</span>
      <span class='id identifier rubyid_dut'>dut</span><span class='period'>.</span><span class='id identifier rubyid_jtag'>jtag</span><span class='period'>.</span><span class='id identifier rubyid_write_ir'>write_ir</span><span class='lparen'>(</span><span class='id identifier rubyid_reg'>reg</span><span class='rparen'>)</span>
    <span class='kw'>else</span>

      <span class='id identifier rubyid_log'>log</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Write JTAG-DP register </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_reg'>reg</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_upcase'>upcase</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_reg'>reg</span><span class='period'>.</span><span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_to_hex'>to_hex</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_reg'>reg</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>==</span> <span class='symbol'>:abort</span>
          <span class='id identifier rubyid_ir'>ir</span><span class='period'>.</span><span class='id identifier rubyid_write!'>write!</span><span class='lparen'>(</span><span class='id identifier rubyid_reg'>reg</span><span class='period'>.</span><span class='id identifier rubyid_offset'>offset</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_dr'>dr</span><span class='period'>.</span><span class='id identifier rubyid_reset'>reset</span>
          <span class='id identifier rubyid_dr'>dr</span><span class='period'>.</span><span class='id identifier rubyid_overlay'>overlay</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_dr'>dr</span><span class='lbracket'>[</span><span class='int'>2</span><span class='op'>..</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_dr'>dr</span><span class='lbracket'>[</span><span class='int'>34</span><span class='op'>..</span><span class='int'>3</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_copy_all'>copy_all</span><span class='lparen'>(</span><span class='id identifier rubyid_reg'>reg</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_dut'>dut</span><span class='period'>.</span><span class='id identifier rubyid_jtag'>jtag</span><span class='period'>.</span><span class='id identifier rubyid_write_dr'>write_dr</span><span class='lparen'>(</span><span class='id identifier rubyid_dr'>dr</span><span class='rparen'>)</span>

        <span class='comment'># DPACC
</span>        <span class='kw'>elsif</span> <span class='id identifier rubyid_reg'>reg</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>==</span> <span class='symbol'>:ctrlstat</span> <span class='op'>||</span> <span class='id identifier rubyid_reg'>reg</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>==</span> <span class='symbol'>:select</span>
          <span class='id identifier rubyid_dr'>dr</span><span class='period'>.</span><span class='id identifier rubyid_reset'>reset</span>
          <span class='id identifier rubyid_dr'>dr</span><span class='period'>.</span><span class='id identifier rubyid_overlay'>overlay</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_dr'>dr</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_dr'>dr</span><span class='lbracket'>[</span><span class='int'>2</span><span class='op'>..</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='id identifier rubyid_reg'>reg</span><span class='period'>.</span><span class='id identifier rubyid_offset'>offset</span> <span class='op'>&gt;&gt;</span> <span class='int'>2</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_dr'>dr</span><span class='lbracket'>[</span><span class='int'>34</span><span class='op'>..</span><span class='int'>3</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_copy_all'>copy_all</span><span class='lparen'>(</span><span class='id identifier rubyid_reg'>reg</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_ir'>ir</span><span class='period'>.</span><span class='id identifier rubyid_write!'>write!</span><span class='lparen'>(</span><span class='id identifier rubyid_dpacc_select'>dpacc_select</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_dut'>dut</span><span class='period'>.</span><span class='id identifier rubyid_jtag'>jtag</span><span class='period'>.</span><span class='id identifier rubyid_write_dr'>write_dr</span><span class='lparen'>(</span><span class='id identifier rubyid_dr'>dr</span><span class='rparen'>)</span>

        <span class='kw'>else</span>
          <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Can&#39;t write </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_reg'>reg</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='comment'># AP register write
</span>  <span class='kw'>else</span>

    <span class='kw'>unless</span> <span class='id identifier rubyid_reg'>reg</span><span class='period'>.</span><span class='id identifier rubyid_owner'>owner</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="AP.html" title="OrigenARMDebug::AP (class)">AP</a></span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>The JTAG-DP can only write to DP or AP registers!</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_select_ap_reg'>select_ap_reg</span><span class='lparen'>(</span><span class='id identifier rubyid_reg'>reg</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_dr'>dr</span><span class='period'>.</span><span class='id identifier rubyid_reset'>reset</span>
    <span class='id identifier rubyid_dr'>dr</span><span class='period'>.</span><span class='id identifier rubyid_overlay'>overlay</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_dr'>dr</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_dr'>dr</span><span class='lbracket'>[</span><span class='int'>2</span><span class='op'>..</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='id identifier rubyid_reg'>reg</span><span class='period'>.</span><span class='id identifier rubyid_offset'>offset</span> <span class='op'>&gt;&gt;</span> <span class='int'>2</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_dr'>dr</span><span class='lbracket'>[</span><span class='int'>34</span><span class='op'>..</span><span class='int'>3</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_copy_all'>copy_all</span><span class='lparen'>(</span><span class='id identifier rubyid_reg'>reg</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_ir'>ir</span><span class='period'>.</span><span class='id identifier rubyid_write!'>write!</span><span class='lparen'>(</span><span class='id identifier rubyid_apacc_select'>apacc_select</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_dut'>dut</span><span class='period'>.</span><span class='id identifier rubyid_jtag'>jtag</span><span class='period'>.</span><span class='id identifier rubyid_write_dr'>write_dr</span><span class='lparen'>(</span><span class='id identifier rubyid_dr'>dr</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Fri Jan 28 08:28:41 2022 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.27 (ruby-2.6.6).
</div>

    </div>
  </body>
</html>