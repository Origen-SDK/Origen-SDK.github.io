<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta property="og:locale" content="en_US">
    <meta name="content-language" content="en_US">

    
    <title>Origen - Guides</title>
    <meta property="og:title" content="Origen - Guides">
    <meta name="twitter:title" content="Origen - Guides">
    <meta itemprop="name" content="Origen - Guides">
      
  
  
    <link rel="author" href="https://plus.google.com/u/1/b/106463981272125989995/106463981272125989">
  
  
    <meta property="og:url" content="http://origen-sdk.org/origen/guides/pattern/registers">
    <meta name="twitter:url" content="http://origen-sdk.org/origen/guides/pattern/registers">
  
  
    <meta property="og:image" content="http://origen-sdk.org/favicon-260x260.png">
    <meta name="twitter:image" content="http://origen-sdk.org/favicon-260x260.png">
    <meta itemprop="image" content="http://origen-sdk.org/favicon-260x260.png">
    <meta name="twitter:card" content="summary">
  
    <meta property="og:site_name" content="Origen - The Semiconductor Developer's Kit">
  
  
    <meta property="fb:admins" content="origensdk">
  
  
    <meta name="twitter:site" content="@origensdk">
  

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="http://origen-sdk.org/css/bootstrap_custom.css"></script>
    <!-- Load this up top to allow pages to execute JQuery snippets -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      
        ga('create', 'UA-64455560-1', 'auto');
        ga('send', 'pageview');
      </script>
    

    <!-- Fav and touch icons -->
    <link rel="apple-touch-icon" sizes="57x57" href="http://origen-sdk.org/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="http://origen-sdk.org/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="http://origen-sdk.org/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="http://origen-sdk.org/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="http://origen-sdk.org/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="http://origen-sdk.org/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="http://origen-sdk.org/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="http://origen-sdk.org/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="http://origen-sdk.org/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="http://origen-sdk.org/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="http://origen-sdk.org/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="http://origen-sdk.org/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="http://origen-sdk.org/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="http://origen-sdk.org/manifest.json">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
  </head>

  <body>
    
      <div class="container">
        <nav class="navbar navbar-inverse navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <a href="/" class="navbar-brand" style="margin-top: -4px;">
        <img src="http://origen-sdk.org/img/origen-device.png" style="height:30px; margin-right: 2px; display: inline; margin-top: -2px;">
        <img src="http://origen-sdk.org/img/origen-text.png" style="height:15px; display: inline;">
      </a>
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <div id="navbar" class="collapse navbar-collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown ">
          <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="tour">Tour <span class="caret"></span></a>
          <ul class="dropdown-menu" aria-labelledby="tour">
            <li><a href="/origen/tour/basics">Basics</a></li>
            <li class="divider">
            </li>
<li><a href="/origen/tour/test-engineering">Test Engineers</a></li>
            <li><a href="/origen/tour/design-engineering">Design Engineers</a></li>
          </ul>
        </li>
        <li class="active"><a href="/origen/guides/starting/introduction">Guides</a></li>
        <li class=""><a href="/origen/videos/1-pattern-in-20-minutes">Videos</a></li>
        <li class=""><a href="/origen/publications">Publications</a></li>
        <li class=""><a href="/origen/api">API</a></li>
        <li class=""><a href="https://github.com/Origen-SDK">Github</a></li>
        <li class=""><a href="/origen/community">Community</a></li>
        <li class=""><a href="/origen/release_notes">Release Notes</a></li>
        <li class=""><a href="/origen/plugins">Plugins</a></li>
      </ul>
    </div>
<!--/.nav-collapse -->
  </div>
</nav>

<div class="row">
  <div class="col-md-3 sidebar-nav-container">
    <div class="well sidebar-nav" style="margin-top: 20px;">
        <div id="search">
          <form style="margin-bottom: 15px;">
            <div class="input-group">
              <input class="form-control" type="search" placeholder="Search the guides...">
              <span class="input-group-btn">
                <button type="submit" class="btn btn-search">GO!</button>
              </span>
            </div>
          </form>
        </div>
        <div class="panel-group" id="sidebar-accordion">

          <div class="panel panel-default">
            <div class="panel-heading clickable" data-toggle="collapse" data-parent="#sidebar-accordion" href="#sidebar-collapse-0">
              <a class="no-underline">
                Getting Started with Origen
              </a>
            </div>
            <div id="sidebar-collapse-0" class="panel-collapse collapse ">
              <div class="panel-body">
                <ul class="nav nav-list">
<li class=""><a href="/origen/guides/starting/introduction">Introduction</a></li>
<li class=""><a href="/origen/guides/starting/core">Core concepts</a></li>
<li class=""><a href="/origen/guides/starting/installing">How to Install</a></li>
<li class=""><a href="/origen/guides/starting/installwin">How to Install (Windows)</a></li>
<li class=""><a href="/origen/guides/starting/company">Company Customization</a></li>
<li class=""><a href="/origen/guides/starting/gems">Understanding Gems</a></li>
<li class=""><a href="/origen/guides/starting/app">Creating a New App</a></li>
<li class=""><a href="/origen/guides/starting/commit">The Initial Commit</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="panel panel-default">
            <div class="panel-heading clickable" data-toggle="collapse" data-parent="#sidebar-accordion" href="#sidebar-collapse-1">
              <a class="no-underline">
                Runtime Environment
              </a>
            </div>
            <div id="sidebar-collapse-1" class="panel-collapse collapse ">
              <div class="panel-body">
                <ul class="nav nav-list">
<li class=""><a href="/origen/guides/runtime/introduction">Introduction</a></li>
<li class=""><a href="/origen/guides/runtime/mode">Mode</a></li>
<li class=""><a href="/origen/guides/runtime/environment">Environment</a></li>
<li class=""><a href="/origen/guides/runtime/target">Target</a></li>
<li class=""><a href="/origen/guides/runtime/production">Production Targets</a></li>
<li class=""><a href="/origen/guides/runtime/global">Global Setup</a></li>
<li class=""><a href="/origen/guides/runtime/loadorder">Load Order</a></li>
<li class=""><a href="/origen/guides/runtime/programming">Programming</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="panel panel-default">
            <div class="panel-heading clickable" data-toggle="collapse" data-parent="#sidebar-accordion" href="#sidebar-collapse-2">
              <a class="no-underline">
                Models
              </a>
            </div>
            <div id="sidebar-collapse-2" class="panel-collapse collapse ">
              <div class="panel-body">
                <ul class="nav nav-list">
<li class=""><a href="/origen/guides/models/introduction">Introduction</a></li>
<li class=""><a href="/origen/guides/models/naming">Naming</a></li>
<li class=""><a href="/origen/guides/models/defining">Definition &amp; Hierarchy</a></li>
<li class=""><a href="/origen/guides/models/attributes">Adding Attributes</a></li>
<li class=""><a href="/origen/guides/models/versioning">Versioning</a></li>
<li class=""><a href="/origen/guides/models/bugs">Bugs &amp; Features</a></li>
<li class=""><a href="/origen/guides/models/modes">Package, Mode &amp; Configuration</a></li>
<li class=""><a href="/origen/guides/models/registers">Registers</a></li>
<li class=""><a href="/origen/guides/models/pins">Pins</a></li>
<li class=""><a href="/origen/guides/models/hw">Hardware Attributes</a></li>
<li class=""><a href="/origen/guides/models/parameters">Parameters</a></li>
<li class=""><a href="/origen/guides/models/specs">Specifications</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="panel panel-default">
            <div class="panel-heading clickable" data-toggle="collapse" data-parent="#sidebar-accordion" href="#sidebar-collapse-3">
              <a class="no-underline">
                Compiler (Views)
              </a>
            </div>
            <div id="sidebar-collapse-3" class="panel-collapse collapse ">
              <div class="panel-body">
                <ul class="nav nav-list">
<li class=""><a href="/origen/guides/compiler/introduction">Introduction</a></li>
<li class=""><a href="/origen/guides/compiler/creating">Creating Templates</a></li>
<li class=""><a href="/origen/guides/compiler/subtemplates">Using Sub-Templates</a></li>
<li class=""><a href="/origen/guides/compiler/helpers">Helpers</a></li>
<li class=""><a href="/origen/guides/compiler/running">Running The Compiler</a></li>
<li class=""><a href="/origen/guides/compiler/inline">Inline Compiler</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="panel panel-default">
            <div class="panel-heading clickable" data-toggle="collapse" data-parent="#sidebar-accordion" href="#sidebar-collapse-4">
              <a class="no-underline">
                Controllers
              </a>
            </div>
            <div id="sidebar-collapse-4" class="panel-collapse collapse ">
              <div class="panel-body">
                <ul class="nav nav-list">
<li class=""><a href="/origen/guides/controllers/introduction">Introduction</a></li>
<li class=""><a href="/origen/guides/controllers/shadow">Shadow Controllers</a></li>
<li class=""><a href="/origen/guides/controllers/direct">Direct Controllers</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="panel panel-default">
            <div class="panel-heading clickable" data-toggle="collapse" data-parent="#sidebar-accordion" href="#sidebar-collapse-5">
              <a class="no-underline">
                Pattern Generator
              </a>
            </div>
            <div id="sidebar-collapse-5" class="panel-collapse collapse in">
              <div class="panel-body">
                <ul class="nav nav-list">
<li class=""><a href="/origen/guides/pattern/introduction">Introduction</a></li>
<li class=""><a href="/origen/guides/pattern/creating">Creating Patterns</a></li>
<li class=""><a href="/origen/guides/pattern/pins">Pins</a></li>
<li class=""><a href="/origen/guides/pattern/timing">Timing and Waiting</a></li>
<li class="active"><a href="/origen/guides/pattern/registers">Registers</a></li>
<li class=""><a href="/origen/guides/pattern/documenting">Documenting Patterns</a></li>
<li class=""><a href="/origen/guides/pattern/name">Generating by Name</a></li>
<li class=""><a href="/origen/guides/pattern/common">Common API</a></li>
<li class=""><a href="/origen/guides/pattern/j750">J750 API</a></li>
<li class=""><a href="/origen/guides/pattern/v93k">V93K API</a></li>
<li class=""><a href="/origen/guides/pattern/ultraflex">UltraFlex API</a></li>
<li class=""><a href="/origen/guides/pattern/custom">Custom Testers</a></li>
<li class=""><a href="/origen/guides/pattern/running">Running The PatGen</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="panel panel-default">
            <div class="panel-heading clickable" data-toggle="collapse" data-parent="#sidebar-accordion" href="#sidebar-collapse-6">
              <a class="no-underline">
                Test Program Generator
              </a>
            </div>
            <div id="sidebar-collapse-6" class="panel-collapse collapse ">
              <div class="panel-body">
                <ul class="nav nav-list">
<li class=""><a href="/origen/guides/program/introduction">Introduction</a></li>
<li class=""><a href="/origen/guides/program/philosophy">Philosophy</a></li>
<li class=""><a href="/origen/guides/program/flows">Creating Flows</a></li>
<li class=""><a href="/origen/guides/program/flowapi">Managing Flow Control</a></li>
<li class=""><a href="/origen/guides/program/interface">Creating an Interface</a></li>
<li class=""><a href="/origen/guides/program/resources">Additional Resources</a></li>
<li class=""><a href="/origen/guides/program/code">Dynamic Custom Code</a></li>
<li class=""><a href="/origen/guides/program/j750">J750 API</a></li>
<li class=""><a href="/origen/guides/program/v93k">V93K API</a></li>
<li class=""><a href="/origen/guides/program/ultraflex">UltraFLEX API</a></li>
<li class=""><a href="/origen/guides/program/doc">Documenting the Program</a></li>
<li class=""><a href="/origen/guides/program/custom">Creating Custom Testers</a></li>
<li class=""><a href="/origen/guides/program/generating">Running the ProgGen</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="panel panel-default">
            <div class="panel-heading clickable" data-toggle="collapse" data-parent="#sidebar-accordion" href="#sidebar-collapse-7">
              <a class="no-underline">
                Documentation Generator
              </a>
            </div>
            <div id="sidebar-collapse-7" class="panel-collapse collapse ">
              <div class="panel-body">
                <ul class="nav nav-list">
<li class=""><a href="/origen/guides/documentation/introduction">Introduction</a></li>
<li class=""><a href="/origen/guides/documentation/markdown">Markdown</a></li>
<li class=""><a href="/origen/guides/documentation/linking">Linking</a></li>
<li class=""><a href="/origen/guides/documentation/styling">Styling</a></li>
<li class=""><a href="/origen/guides/documentation/testing">Testing</a></li>
<li class=""><a href="/origen/guides/documentation/api">API Generation</a></li>
<li class=""><a href="/origen/guides/documentation/deploying">Deploying</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="panel panel-default">
            <div class="panel-heading clickable" data-toggle="collapse" data-parent="#sidebar-accordion" href="#sidebar-collapse-8">
              <a class="no-underline">
                Plugins
              </a>
            </div>
            <div id="sidebar-collapse-8" class="panel-collapse collapse ">
              <div class="panel-body">
                <ul class="nav nav-list">
<li class=""><a href="/origen/guides/plugins/introduction">Introduction</a></li>
<li class=""><a href="/origen/guides/plugins/importing">Using a Plugin</a></li>
<li class=""><a href="/origen/guides/plugins/creating">Creating a Plugin</a></li>
<li class=""><a href="/origen/guides/plugins/current">Current Plugin</a></li>
<li class=""><a href="/origen/guides/plugins/environment">Dev Environment</a></li>
<li class=""><a href="/origen/guides/plugins/development">Dev Considerations</a></li>
<li class=""><a href="/origen/guides/plugins/paths">Paths &amp; Origen.root</a></li>
<li class=""><a href="/origen/guides/plugins/app">Config &amp; Origen.app</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="panel panel-default">
            <div class="panel-heading clickable" data-toggle="collapse" data-parent="#sidebar-accordion" href="#sidebar-collapse-9">
              <a class="no-underline">
                Miscellaneous
              </a>
            </div>
            <div id="sidebar-collapse-9" class="panel-collapse collapse ">
              <div class="panel-body">
                <ul class="nav nav-list">
<li class=""><a href="/origen/guides/misc/revisioncontrol">Revision Control</a></li>
<li class=""><a href="/origen/guides/misc/remotes">Origen Remotes</a></li>
<li class=""><a href="/origen/guides/misc/lint">Lint Testing</a></li>
<li class=""><a href="/origen/guides/misc/session">Session Store</a></li>
<li class=""><a href="/origen/guides/misc/lsf">LSF API</a></li>
<li class=""><a href="/origen/guides/misc/users">Users, Emails &amp; Maillists</a></li>
<li class=""><a href="/origen/guides/misc/coreext">Ruby Extensions</a></li>
<li class=""><a href="/origen/guides/misc/logger">Logger</a></li>
<li class=""><a href="/origen/guides/misc/commands">Adding Commands</a></li>
<li class=""><a href="/origen/guides/misc/commandsov">Overriding Commands</a></li>
<li class=""><a href="/origen/guides/misc/callbacks">Callbacks</a></li>
<li class=""><a href="/origen/guides/misc/appcallbacks">Application Callbacks</a></li>
                </ul>
              </div>
            </div>
          </div>
      

        </div>

    </div>
  </div>

  <div class="col-md-9 nav-page-container">
    <article>

      <h3 class="topic-title">Pattern Generator</h3>

      <h2 class="topic-subtitle">Registers</h2>

      <hr>

      <p>The majority of patterns are concerned with reading and writing to registers to make the
DUT do something and consequently 
more than 90% of your time developing an Origen test application should be concerned with
writing code at the register level.</p>

      <p>All test <a href="/origen/plugins/#Transaction_Protocol_Drivers">transaction drivers</a>
such as the <a href="http://origen-sdk.org/arm_debug">ARM Debug driver</a> are expected to support the basic
Origen register API. This allows the test engineer to develop code at register level and
independently of the underlying test communication protocol which can be easily changed
to something else as required.</p>

      <div>    
  <a class="anchor" name="Basic_Concept"></a>          
  <h4><a href="#Basic_Concept">Basic Concept</a></h4>          
</div>

      <p>See the <a href="/origen/guides/models/registers">Registers</a> section of
the <a href="/origen/guides/models/introduction">Models</a> guide for details and examples
of how to add and manipulate register states within your model logic.</p>

      <p>Interaction with the registers should be limited to the <a href="/origen/guides/controllers/introduction">model’s controller</a>
- no one else should reach into a model to manipulate its register state (this is not prevented
but recommended), and the controllers should instead expose interface methods for the outside
world to use. Internally such methods will work by manipulating registers in a sequence.</p>

      <p>The <code>read!</code> and <code>write!</code> methods when called on a register (or bit) will
automatically fire off a request for the register to be written using the following
rules:</p>

      <ul>
        <li>If the model or controller that owns the register implements a <code>write_register</code> method
then call this with the target register passed in as the argument</li>
        <li>Otherwise if the object that owns the register implements an <code>owner</code> method,
then see if the object that this returns provides a suitable <code>write_register</code>
method</li>
        <li>If not then if a currently instantiated model includes the <code>Origen::TopLevel</code>
module then see if it (or its controller) has a <code>write_register</code> method available</li>
        <li>If the request has still not been fulfilled then raise an error</li>
      </ul>

      <p>Read works in the same way except that it looks for a method called <code>read_register</code>.</p>

      <p>What this all means is that within a controller you will build your
test logic from methods that look like this:</p>

      <div class="language-ruby highlighter-coderay">
<div class="CodeRay">
  <div class="code"><pre><span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">measure_vref</span>(setting=<span style="color:#069">nil</span>)
  <span style="color:#080;font-weight:bold">if</span> setting
    ss <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Measure the Vref voltage for setting </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>setting<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">"</span></span>
    vref.level.write(setting)
  <span style="color:#080;font-weight:bold">else</span>
    ss <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Measure the default Vref voltage</span><span style="color:#710">"</span></span>
  <span style="color:#080;font-weight:bold">end</span>
  vref.test_enable.write!(<span style="color:#00D">1</span>)
<span style="color:#080;font-weight:bold">end</span>

<span style="color:#777"># From a pattern call like this:</span>
<span style="color:#036;font-weight:bold">Pattern</span>.create <span style="color:#080;font-weight:bold">do</span>
  <span style="color:#d70">$dut</span>.nvm.measure_vref(<span style="color:#00D">5</span>)
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
      </div>

      <p>The actual mechanism for how the registers are written is abstracted away from the
test logic itself and therefore the test logic is generally independent from the communication
protocol. This is a very powerful concept that allows plugins to be created that provide 
test sequences for a specific silicon module and these can then be re-used on DUTs that
employ completely different register access protocols.</p>

      <div>    
  <a class="anchor" name="Recommended_Architecture"></a>          
  <h4><a href="#Recommended_Architecture">Recommended Architecture</a></h4>          
</div>

      <p>This is the recommended architecture for modern Origen applications that will lend itself
to working well within a plugin-based environment.</p>

      <p>Define registers in the child models that own them and create test methods to manipulate them
in the controller:</p>

      <div class="language-ruby highlighter-coderay">
<div class="CodeRay">
  <div class="code"><pre><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">NVM</span>
  include <span style="color:#036;font-weight:bold">Origen</span>::<span style="color:#036;font-weight:bold">Model</span>

  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">initialize</span>
    reg <span style="color:#A60">:vref</span>, <span style="color:#00D">0x0003</span>, <span style="color:#606">size</span>: <span style="color:#00D">16</span> <span style="color:#080;font-weight:bold">do</span> |reg|
      reg.bit <span style="color:#00D">15</span>,   <span style="color:#A60">:test_enable</span>
      reg.bit <span style="color:#00D">7</span>..<span style="color:#00D">0</span>, <span style="color:#A60">:level</span>
    <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

<span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">NVMController</span>
  include <span style="color:#036;font-weight:bold">Origen</span>::<span style="color:#036;font-weight:bold">Controller</span>

  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">measure_vref</span>(setting=<span style="color:#069">nil</span>)
    <span style="color:#080;font-weight:bold">if</span> setting
      ss <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Measure the Vref voltage for setting </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>setting<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">"</span></span>
      vref.level.write(setting)
    <span style="color:#080;font-weight:bold">else</span>
      ss <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Measure the default Vref voltage</span><span style="color:#710">"</span></span>
    <span style="color:#080;font-weight:bold">end</span>
    vref.test_enable.write!(<span style="color:#00D">1</span>)
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
      </div>

      <p>Defer how to actually write the register to the top-level SoC controller and normally this would
be done via one of the available protocol plugins.
Here for example is an SoC which will write the register via the <a href="http://origen-sdk.org/nexus">Nexus protocol</a>:</p>

      <div class="language-ruby highlighter-coderay">
<div class="CodeRay">
  <div class="code"><pre><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MySoC</span>
  include <span style="color:#036;font-weight:bold">Origen</span>::<span style="color:#036;font-weight:bold">TopLevel</span>  <span style="color:#777"># Indicate to Origen that this model represents a top-level device object</span>
<span style="color:#080;font-weight:bold">end</span>

<span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MySoCController</span>
  include <span style="color:#036;font-weight:bold">Origen</span>::<span style="color:#036;font-weight:bold">Controller</span>
  include <span style="color:#036;font-weight:bold">Nexus</span>

  <span style="color:#777"># Process register reads using the Nexus protocol</span>
  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">read_register</span>(reg, options={})
    nexus.read_register(reg, options)
  <span style="color:#080;font-weight:bold">end</span>

  <span style="color:#777"># As above for write requests</span>
  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">write_register</span>(reg, options={})
    nexus.write_register(reg, options)
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
      </div>

      <p>And that is all that is required, Origen takes care of the hook up and the behind the scenes
communication to make it all work.</p>

      <p>Another target may then instantiate a different SoC model which could use a completely different
protocol like <a href="http://origen-sdk.org/arm_debug">ARM Debug</a>, in which case the NVM test module would
still work although the generated pattern would look completely different.</p>

      <div>    
  <a class="anchor" name="Bit_Level_Access"></a>          
  <h4><a href="#Bit_Level_Access">Bit Level Access</a></h4>          
</div>

      <p>All registers support bit level updates, we have seen an example of this already:</p>

      <div class="language-ruby highlighter-coderay">
<div class="CodeRay">
  <div class="code"><pre>vref.test_enable.write!(<span style="color:#00D">1</span>)
</pre></div>
</div>
      </div>

      <p>What this will do is update the value held by the given bits and then send the parent
register object to the <code>write_register</code> method for processing.
All other bits in the register will maintain the state that they had prior to this
operation commencing.</p>

      <p>Since it is not generally possible to update only a subset of bits on a device the entire
register will still be updated on silicon.
However in the case of performing a bit-level read things get a bit more interesting.</p>

      <p>The equivalent read operation will update the data values of the bits in the same way, but
it will also set a flag on those bits marking that they have been requested for read.</p>

      <div class="language-ruby highlighter-coderay">
<div class="CodeRay">
  <div class="code"><pre>vref.test_enable.read!(<span style="color:#00D">1</span>)
</pre></div>
</div>
      </div>

      <p>The protocol driver can then look out for this flag when generating the readout vectors
and only enable a compare on the vectors that correspond to the bits marked for read.
Generally this takes a lot of the cognitive overhead out of writing patterns since you
can mentally disregard the state of all bits except the ones that you care about.</p>

      <p>All standard Origen protocol plugins are expected to support this feature.</p>

      <p>The same is true for store (meaning capture the value on the tester) or overlay operations:</p>

      <div class="language-ruby highlighter-coderay">
<div class="CodeRay">
  <div class="code"><pre><span style="color:#777"># Capture the value of the level bits</span>
vref.level.store!

<span style="color:#777"># Dynamically overlay the value written to the level bits</span>
vref.level.overlay(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">vref_setting</span><span style="color:#710">"</span></span>)
vref.write!
</pre></div>
</div>
      </div>

      <div>    
  <a class="anchor" name="Writing_a_Driver"></a>          
  <h4><a href="#Writing_a_Driver">Writing a Driver</a></h4>          
</div>

      <p>Generally the code for an existing driver should be reviewed to see how to go about this,
the <a href="http://origen-sdk.org/jtag">JTAG driver</a> would be a good example to look at,
but here are some basic pointers on good driver design.</p>

      <p>All drivers should implement read and write register methods:</p>

      <div class="language-ruby highlighter-coderay">
<div class="CodeRay">
  <div class="code"><pre><span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">write_register</span>(reg, options={})
<span style="color:#080;font-weight:bold">end</span>

<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">read_register</span>(reg, options={})
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
      </div>

      <p>The write methods are usually fairly simple, here is a basic example of how to do a parallel
and a serial protocol write:</p>

      <div class="language-ruby highlighter-coderay">
<div class="CodeRay">
  <div class="code"><pre><span style="color:#777"># Writing on a parallel port, let's say we have a 16-bit register and the</span>
<span style="color:#777"># data needs to be written on a pin group called data which is 8-bits</span>
<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">write_register</span>(reg, options={})
  pin(<span style="color:#A60">:din</span>).drive(<span style="color:#00D">1</span>)   <span style="color:#777"># Let's say when this pin is high data is captured</span>
  <span style="color:#777"># Drive the data in MSB -&gt; LSB order</span>
  pins(<span style="color:#A60">:data</span>).drive!(reg[<span style="color:#00D">15</span>..<span style="color:#00D">8</span>].data)
  pins(<span style="color:#A60">:data</span>).drive!(reg[<span style="color:#00D">7</span>..<span style="color:#00D">0</span>].data)
  pin(<span style="color:#A60">:din</span>).drive(<span style="color:#00D">0</span>)   <span style="color:#777"># Turn off capture</span>
<span style="color:#080;font-weight:bold">end</span>

<span style="color:#777"># Writing on a serial port, same as above only this time the :data port is</span>
<span style="color:#777"># only 1-bit wide</span>
<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">read_register</span>(reg, options={})
  pin(<span style="color:#A60">:din</span>).drive(<span style="color:#00D">1</span>)   <span style="color:#777"># Let's say when this pin is high data is captured</span>
  <span style="color:#777"># Drive the data in MSB -&gt; LSB order</span>
  reg.shift_out_left <span style="color:#080;font-weight:bold">do</span> |bit|
    pin(<span style="color:#A60">:data</span>).drive!(bit.data)
  <span style="color:#080;font-weight:bold">end</span>
  pin(<span style="color:#A60">:din</span>).drive(<span style="color:#00D">0</span>)   <span style="color:#777"># Turn off capture</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
      </div>

      <p>Read methods are usually a bit more involved to implement the bit-specific read and
capture operations.
Here is a parallel and serial protocol example which supports bit-level read operations:</p>

      <div class="language-ruby highlighter-coderay">
<div class="CodeRay">
  <div class="code"><pre><span style="color:#777"># Reading on a parallel port, let's say we have a 16-bit register and the</span>
<span style="color:#777"># data needs to be read on a pin group called data which is 8-bits</span>
<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">write_register</span>(reg, options={})
  pin(<span style="color:#A60">:dout</span>).drive(<span style="color:#00D">1</span>)   <span style="color:#777"># Let's say when this pin is high data is presented</span>

  <span style="color:#777"># Compare the data in MSB</span>
  <span style="color:#00D">8</span>.times <span style="color:#080;font-weight:bold">do</span> |i|
    bit = reg.bit(i + <span style="color:#00D">8</span>)
    <span style="color:#080;font-weight:bold">if</span> bit.is_to_be_read?
      pins(<span style="color:#A60">:data</span>)[i].assert(bit.data)
    <span style="color:#080;font-weight:bold">else</span>
      pins(<span style="color:#A60">:data</span>)[i].dont_care
    <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#d70">$tester</span>.cycle

  <span style="color:#777"># Now the data in LSB</span>
  <span style="color:#00D">8</span>.times <span style="color:#080;font-weight:bold">do</span> |i|
    bit = reg.bit(i)
    <span style="color:#080;font-weight:bold">if</span> bit.is_to_be_read?
      pins(<span style="color:#A60">:data</span>)[i].assert(bit.data)
    <span style="color:#080;font-weight:bold">else</span>
      pins(<span style="color:#A60">:data</span>)[i].dont_care
    <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#d70">$tester</span>.cycle

  pin(<span style="color:#A60">:dout</span>).drive(<span style="color:#00D">0</span>)   <span style="color:#777"># Turn off read out</span>
<span style="color:#080;font-weight:bold">end</span>

<span style="color:#777"># Reading on a serial port, same as above only this time the :data port is</span>
<span style="color:#777"># only 1-bit wide</span>
<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">read_register</span>(reg, options={})
  pin(<span style="color:#A60">:dout</span>).drive(<span style="color:#00D">1</span>)   <span style="color:#777"># Let's say when this pin is high data is presented</span>

  <span style="color:#777"># Drive the data in MSB -&gt; LSB order</span>
  reg.shift_out_left <span style="color:#080;font-weight:bold">do</span> |bit|
    <span style="color:#080;font-weight:bold">if</span> bit.is_to_be_read?
      pin(<span style="color:#A60">:data</span>).assert!(bit.data)
    <span style="color:#080;font-weight:bold">else</span>
      pin(<span style="color:#A60">:data</span>).dont_care!
    <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#080;font-weight:bold">end</span>

  pin(<span style="color:#A60">:dout</span>).drive(<span style="color:#00D">0</span>)   <span style="color:#777"># Turn off read out</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
      </div>

      <div style="position: relative">
  <hr>
  <div>    
  <a class="anchor" name="Comments"></a>          
  <h4><a href="#Comments">Comments</a></h4>          
</div>
</div>
      <div id="disqus_thread"></div>
      <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'origen-sdk';
    var disqus_title;
    var disqus_url = 'http://' + window.location.hostname + window.location.pathname;

    disqus_title = $("h1").text();
    if (disqus_title.length == 0) {
      disqus_title = $("h2").text();
    }
    if (disqus_title.length == 0) {
      disqus_title = $("h3").text();
    }
    if (disqus_title.length == 0) {
      disqus_title = $("title").text();
    } else {
      disqus_title = disqus_title + ' (' + $("title").text() + ')';
    }

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

      <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>

    </article>
  </div>
</div>

<script src="/origen/search.js"></script>


      </div><!-- /.container -->
    

    <footer class="footer">
      <div class="container">
        <p class="pull-left text-muted">
          Generated with the <a href="http://origen-sdk.org">Origen Semiconductor Developer's Kit</a>
        </p>
        <p class="pull-right text-muted">Origen is released under the terms of the <a href="http://choosealicense.com/licenses/lgpl-3.0/">LGPLv3</a></p>
      </div>
    </footer>
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script src="http://origen-sdk.org/js/lunr.min.js"></script>
    <script src="http://origen-sdk.org/js/highlight.js"></script>
    <script src="http://origen-sdk.org/js/custom.js"></script>
    
      <script>
        ((window.gitter = {}).chat = {}).options = {
          room: 'Origen-SDK/users'
        };
      </script>
      <script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>
    
  </body>
</html>
