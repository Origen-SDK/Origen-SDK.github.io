<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta property="og:locale" content="en_US">
    <meta name="content-language" content="en_US">

    
    <title>Origen - Guides</title>
    <meta property="og:title" content="Origen - Guides">
    <meta name="twitter:title" content="Origen - Guides">
    <meta itemprop="name" content="Origen - Guides">
      
  
  
    <link rel="author" href="https://plus.google.com/u/1/b/106463981272125989995/106463981272125989">
  
  
    <meta property="og:url" content="http://origen-sdk.org/origen/scratch/nxa21353/">
    <meta name="twitter:url" content="http://origen-sdk.org/origen/scratch/nxa21353/">
  
  
    <meta property="og:image" content="http://origen-sdk.org/favicon-260x260.png">
    <meta name="twitter:image" content="http://origen-sdk.org/favicon-260x260.png">
    <meta itemprop="image" content="http://origen-sdk.org/favicon-260x260.png">
    <meta name="twitter:card" content="summary">
  
    <meta property="og:site_name" content="Origen - The Semiconductor Developer's Kit">
  
  
    <meta property="fb:admins" content="origensdk">
  
  
    <meta name="twitter:site" content="@origensdk">
  

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="http://origen-sdk.org/css/bootstrap_custom.css"></script>
    <!-- Load this up top to allow pages to execute JQuery snippets -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      
        ga('create', 'UA-64455560-1', 'auto');
        ga('send', 'pageview');
      </script>
    

    <!-- Fav and touch icons -->
    <link rel="apple-touch-icon" sizes="57x57" href="http://origen-sdk.org/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="http://origen-sdk.org/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="http://origen-sdk.org/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="http://origen-sdk.org/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="http://origen-sdk.org/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="http://origen-sdk.org/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="http://origen-sdk.org/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="http://origen-sdk.org/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="http://origen-sdk.org/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="http://origen-sdk.org/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="http://origen-sdk.org/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="http://origen-sdk.org/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="http://origen-sdk.org/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="http://origen-sdk.org/manifest.json">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
  </head>

  <body>
    
      <div class="container">
        <nav class="navbar navbar-inverse navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <a href="/" class="navbar-brand" style="margin-top: -4px;">
        <img src="http://origen-sdk.org/img/origen-device.png" style="height:30px; margin-right: 2px; display: inline; margin-top: -2px;">
        <img src="http://origen-sdk.org/img/origen-text.png" style="height:15px; display: inline;">
      </a>
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <div id="navbar" class="collapse navbar-collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown ">
          <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="tour">Tour <span class="caret"></span></a>
          <ul class="dropdown-menu" aria-labelledby="tour">
            <li><a href="/origen/tour/basics">Basics</a></li>
            <li class="divider">
            </li>
<li><a href="/origen/tour/test-engineering">Test Engineers</a></li>
            <li><a href="/origen/tour/design-engineering">Design Engineers</a></li>
          </ul>
        </li>
        <li class="active"><a href="/origen/guides/starting/introduction">Guides</a></li>
        <li class=""><a href="/origen/videos/1-pattern-in-20-minutes">Videos</a></li>
        <li class=""><a href="/origen/publications">Publications</a></li>
        <li class=""><a href="/origen/api">API</a></li>
        <li class=""><a href="https://github.com/Origen-SDK">Github</a></li>
        <li class=""><a href="/origen/community">Community</a></li>
        <li class=""><a href="/origen/release_notes">Release Notes</a></li>
        <li class=""><a href="/origen/plugins">Plugins</a></li>
      </ul>
    </div>
<!--/.nav-collapse -->
  </div>
</nav>

<div class="row">
  <div class="col-md-3 sidebar-nav-container">
    <div class="well sidebar-nav" style="margin-top: 20px;">
        <div id="search">
          <form style="margin-bottom: 15px;">
            <div class="input-group">
              <input class="form-control" type="search" placeholder="Search the guides...">
              <span class="input-group-btn">
                <button type="submit" class="btn btn-search">GO!</button>
              </span>
            </div>
          </form>
        </div>
        <div class="panel-group" id="sidebar-accordion">

          <div class="panel panel-default">
            <div class="panel-heading clickable" data-toggle="collapse" data-parent="#sidebar-accordion" href="#sidebar-collapse-0">
              <a class="no-underline">
                Getting Started with Origen
              </a>
            </div>
            <div id="sidebar-collapse-0" class="panel-collapse collapse ">
              <div class="panel-body">
                <ul class="nav nav-list">
<li class=""><a href="/origen/guides/starting/introduction">Introduction</a></li>
<li class=""><a href="/origen/guides/starting/core">Core concepts</a></li>
<li class=""><a href="/origen/guides/starting/installing">How to Install</a></li>
<li class=""><a href="/origen/guides/starting/installwin">How to Install (Windows)</a></li>
<li class=""><a href="/origen/guides/starting/company">Company Customization</a></li>
<li class=""><a href="/origen/guides/starting/gems">Understanding Gems</a></li>
<li class=""><a href="/origen/guides/starting/app">Creating a New App</a></li>
<li class=""><a href="/origen/guides/starting/invoking">Invoking Considerations</a></li>
<li class=""><a href="/origen/guides/starting/commit">The Initial Commit</a></li>
<li class=""><a href="/origen/guides/starting/workspace">Workspace Management</a></li>
<li class=""><a href="/origen/guides/starting/architecture">Application Architecture</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="panel panel-default">
            <div class="panel-heading clickable" data-toggle="collapse" data-parent="#sidebar-accordion" href="#sidebar-collapse-1">
              <a class="no-underline">
                Runtime Environment
              </a>
            </div>
            <div id="sidebar-collapse-1" class="panel-collapse collapse ">
              <div class="panel-body">
                <ul class="nav nav-list">
<li class=""><a href="/origen/guides/runtime/introduction">Introduction</a></li>
<li class=""><a href="/origen/guides/runtime/mode">Mode</a></li>
<li class=""><a href="/origen/guides/runtime/environment">Environment</a></li>
<li class=""><a href="/origen/guides/runtime/target">Target</a></li>
<li class=""><a href="/origen/guides/runtime/production">Production Targets</a></li>
<li class=""><a href="/origen/guides/runtime/global">Global Setup</a></li>
<li class=""><a href="/origen/guides/runtime/loadorder">Load Order</a></li>
<li class=""><a href="/origen/guides/runtime/programming">Programming</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="panel panel-default">
            <div class="panel-heading clickable" data-toggle="collapse" data-parent="#sidebar-accordion" href="#sidebar-collapse-2">
              <a class="no-underline">
                Models
              </a>
            </div>
            <div id="sidebar-collapse-2" class="panel-collapse collapse ">
              <div class="panel-body">
                <ul class="nav nav-list">
<li class=""><a href="/origen/guides/models/introduction">Introduction</a></li>
<li class=""><a href="/origen/guides/models/naming">Naming</a></li>
<li class=""><a href="/origen/guides/models/defining">Definition &amp; Hierarchy</a></li>
<li class=""><a href="/origen/guides/models/attributes">Adding Attributes</a></li>
<li class=""><a href="/origen/guides/models/versioning">Versioning</a></li>
<li class=""><a href="/origen/guides/models/bugs">Bugs &amp; Features</a></li>
<li class=""><a href="/origen/guides/models/modes">Package, Mode &amp; Configuration</a></li>
<li class=""><a href="/origen/guides/models/registers">Registers</a></li>
<li class=""><a href="/origen/guides/models/pins">Pins</a></li>
<li class=""><a href="/origen/guides/models/power">Power Domains</a></li>
<li class=""><a href="/origen/guides/models/hw">Hardware Attributes</a></li>
<li class=""><a href="/origen/guides/models/parameters">Parameters</a></li>
<li class=""><a href="/origen/guides/models/specs">Specifications</a></li>
<li class=""><a href="/origen/guides/models/fuses">Fuses</a></li>
<li class=""><a href="/origen/guides/models/components">Generic Components</a></li>
<li class=""><a href="/origen/guides/models/componentable">Creating Your Own Components</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="panel panel-default">
            <div class="panel-heading clickable" data-toggle="collapse" data-parent="#sidebar-accordion" href="#sidebar-collapse-3">
              <a class="no-underline">
                Compiler (Views)
              </a>
            </div>
            <div id="sidebar-collapse-3" class="panel-collapse collapse ">
              <div class="panel-body">
                <ul class="nav nav-list">
<li class=""><a href="/origen/guides/compiler/introduction">Introduction</a></li>
<li class=""><a href="/origen/guides/compiler/creating">Creating Templates</a></li>
<li class=""><a href="/origen/guides/compiler/subtemplates">Using Sub-Templates</a></li>
<li class=""><a href="/origen/guides/compiler/helpers">Helpers</a></li>
<li class=""><a href="/origen/guides/compiler/running">Running The Compiler</a></li>
<li class=""><a href="/origen/guides/compiler/inline">Inline Compiler</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="panel panel-default">
            <div class="panel-heading clickable" data-toggle="collapse" data-parent="#sidebar-accordion" href="#sidebar-collapse-4">
              <a class="no-underline">
                Controllers
              </a>
            </div>
            <div id="sidebar-collapse-4" class="panel-collapse collapse ">
              <div class="panel-body">
                <ul class="nav nav-list">
<li class=""><a href="/origen/guides/controllers/introduction">Introduction</a></li>
<li class=""><a href="/origen/guides/controllers/shadow">Shadow Controllers</a></li>
<li class=""><a href="/origen/guides/controllers/direct">Direct Controllers</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="panel panel-default">
            <div class="panel-heading clickable" data-toggle="collapse" data-parent="#sidebar-accordion" href="#sidebar-collapse-5">
              <a class="no-underline">
                Pattern Generator
              </a>
            </div>
            <div id="sidebar-collapse-5" class="panel-collapse collapse in">
              <div class="panel-body">
                <ul class="nav nav-list">
<li class=""><a href="/origen/guides/pattern/introduction">Introduction</a></li>
<li class=""><a href="/origen/guides/pattern/creating">Creating Patterns</a></li>
<li class=""><a href="/origen/guides/pattern/pins">Pins</a></li>
<li class=""><a href="/origen/guides/pattern/timing">Timing and Waiting</a></li>
<li class=""><a href="/origen/guides/pattern/registers">Registers</a></li>
<li class=""><a href="/origen/guides/pattern/documenting">Documenting Patterns</a></li>
<li class="active"><a href="/origen/guides/pattern/name">Generating by Name</a></li>
<li class=""><a href="/origen/guides/pattern/common">Common API</a></li>
<li class=""><a href="/origen/guides/pattern/j750">J750 API</a></li>
<li class=""><a href="/origen/guides/pattern/v93k">V93K API</a></li>
<li class=""><a href="/origen/guides/pattern/ultraflex">UltraFlex API</a></li>
<li class=""><a href="/origen/guides/pattern/custom">Custom Testers</a></li>
<li class=""><a href="/origen/guides/pattern/running">Running The PatGen</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="panel panel-default">
            <div class="panel-heading clickable" data-toggle="collapse" data-parent="#sidebar-accordion" href="#sidebar-collapse-6">
              <a class="no-underline">
                Test Program Generator
              </a>
            </div>
            <div id="sidebar-collapse-6" class="panel-collapse collapse ">
              <div class="panel-body">
                <ul class="nav nav-list">
<li class=""><a href="/origen/guides/program/introduction">Introduction</a></li>
<li class=""><a href="/origen/guides/program/philosophy">Philosophy</a></li>
<li class=""><a href="/origen/guides/program/flows">Creating Flows</a></li>
<li class=""><a href="/origen/guides/program/flowapi">Managing Flow Control</a></li>
<li class=""><a href="/origen/guides/program/interface">Creating an Interface</a></li>
<li class=""><a href="/origen/guides/program/resources">Additional Resources</a></li>
<li class=""><a href="/origen/guides/program/code">Dynamic Custom Code</a></li>
<li class=""><a href="/origen/guides/program/j750">J750 API</a></li>
<li class=""><a href="/origen/guides/program/v93k">V93K API</a></li>
<li class=""><a href="/origen/guides/program/ultraflex">UltraFLEX API</a></li>
<li class=""><a href="/origen/guides/program/doc">Documenting the Program</a></li>
<li class=""><a href="/origen/guides/program/custom">Creating Custom Testers</a></li>
<li class=""><a href="/origen/guides/program/generating">Running the ProgGen</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="panel panel-default">
            <div class="panel-heading clickable" data-toggle="collapse" data-parent="#sidebar-accordion" href="#sidebar-collapse-7">
              <a class="no-underline">
                Simulation
              </a>
            </div>
            <div id="sidebar-collapse-7" class="panel-collapse collapse ">
              <div class="panel-body">
                <ul class="nav nav-list">
<li class=""><a href="/origen/guides/simulation/introduction">Introduction</a></li>
<li class=""><a href="/origen/guides/simulation/howitworks">How It Works</a></li>
<li class=""><a href="/origen/guides/simulation/compiling">Compiling the DUT</a></li>
<li class=""><a href="/origen/guides/simulation/environment">Environment Setup</a></li>
<li class=""><a href="/origen/guides/simulation/app">Application Setup</a></li>
<li class=""><a href="/origen/guides/simulation/patterns">Simulating Patterns</a></li>
<li class=""><a href="/origen/guides/simulation/flows">Simulating Flows</a></li>
<li class=""><a href="/origen/guides/simulation/log">Simulator Log Output</a></li>
<li class=""><a href="/origen/guides/simulation/artifacts">Artifacts</a></li>
<li class=""><a href="/origen/guides/simulation/debugging">Interactive Debugging</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="panel panel-default">
            <div class="panel-heading clickable" data-toggle="collapse" data-parent="#sidebar-accordion" href="#sidebar-collapse-8">
              <a class="no-underline">
                Documentation Generator
              </a>
            </div>
            <div id="sidebar-collapse-8" class="panel-collapse collapse ">
              <div class="panel-body">
                <ul class="nav nav-list">
<li class=""><a href="/origen/guides/documentation/introduction">Introduction</a></li>
<li class=""><a href="/origen/guides/documentation/markdown">Markdown</a></li>
<li class=""><a href="/origen/guides/documentation/linking">Linking</a></li>
<li class=""><a href="/origen/guides/documentation/styling">Styling</a></li>
<li class=""><a href="/origen/guides/documentation/testing">Testing</a></li>
<li class=""><a href="/origen/guides/documentation/api">API Generation</a></li>
<li class=""><a href="/origen/guides/documentation/deploying">Deploying</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="panel panel-default">
            <div class="panel-heading clickable" data-toggle="collapse" data-parent="#sidebar-accordion" href="#sidebar-collapse-9">
              <a class="no-underline">
                Plugins
              </a>
            </div>
            <div id="sidebar-collapse-9" class="panel-collapse collapse ">
              <div class="panel-body">
                <ul class="nav nav-list">
<li class=""><a href="/origen/guides/plugins/introduction">Introduction</a></li>
<li class=""><a href="/origen/guides/plugins/importing">Using a Plugin</a></li>
<li class=""><a href="/origen/guides/plugins/creating">Creating a Plugin</a></li>
<li class=""><a href="/origen/guides/plugins/current">Current Plugin</a></li>
<li class=""><a href="/origen/guides/plugins/environment">Dev Environment</a></li>
<li class=""><a href="/origen/guides/plugins/development">Dev Considerations</a></li>
<li class=""><a href="/origen/guides/plugins/paths">Paths &amp; Origen.root</a></li>
<li class=""><a href="/origen/guides/plugins/app">Config &amp; Origen.app</a></li>
<li class=""><a href="/origen/guides/plugins/misc">Miscellaneous Topics</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="panel panel-default">
            <div class="panel-heading clickable" data-toggle="collapse" data-parent="#sidebar-accordion" href="#sidebar-collapse-10">
              <a class="no-underline">
                Miscellaneous
              </a>
            </div>
            <div id="sidebar-collapse-10" class="panel-collapse collapse ">
              <div class="panel-body">
                <ul class="nav nav-list">
<li class=""><a href="/origen/guides/misc/revisioncontrol">Revision Control</a></li>
<li class=""><a href="/origen/guides/misc/remotes">Origen Remotes</a></li>
<li class=""><a href="/origen/guides/misc/lint">Lint Testing</a></li>
<li class=""><a href="/origen/guides/misc/session">Session Store</a></li>
<li class=""><a href="/origen/guides/misc/lsf">LSF API</a></li>
<li class=""><a href="/origen/guides/misc/users">Users, Emails &amp; Maillists</a></li>
<li class=""><a href="/origen/guides/misc/utilities">Utilities &amp; Helpers</a></li>
<li class=""><a href="/origen/guides/misc/coreext">Ruby Extensions</a></li>
<li class=""><a href="/origen/guides/misc/logger">Logger</a></li>
<li class=""><a href="/origen/guides/misc/commands">Adding Commands</a></li>
<li class=""><a href="/origen/guides/misc/commandsov">Overriding Commands</a></li>
<li class=""><a href="/origen/guides/misc/callbacks">Callbacks</a></li>
<li class=""><a href="/origen/guides/misc/appcallbacks">Application Callbacks</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="panel panel-default">
            <div class="panel-heading clickable" data-toggle="collapse" data-parent="#sidebar-accordion" href="#sidebar-collapse-11">
              <a class="no-underline">
                Advanced Topics
              </a>
            </div>
            <div id="sidebar-collapse-11" class="panel-collapse collapse ">
              <div class="panel-body">
                <ul class="nav nav-list">
<li class=""><a href="/origen/guides/advanced/introduction">Introduction</a></li>
<li class=""><a href="/origen/guides/advanced/invocations">Invocation Customization</a></li>
<li class=""><a href="/origen/guides/advanced/newapps">Custom App Generators</a></li>
                </ul>
              </div>
            </div>
          </div>
      

        </div>

    </div>
  </div>

  <div class="col-md-9 nav-page-container">
    <article class="search-results">

      <h3 class="topic-title">Pattern Generator</h3>

      <h2 class="topic-subtitle">Generating by Name</h2>

      <hr>

      <p>In a large application the number of pattern source files can grow very large, for example in the
flagship Origen application we grew to having more than 1500 pattern source files 
at one time!
In such a case even if you follow the 
<a href="/origen/guides/pattern/creating">golden rules for building maintainable patterns</a>
the fact that there are so many of them becomes a maintenance concern by itself and
worries start to creep in about whether all of the patterns really implement a given operation
in exactly the same way.</p>

      <p>Even if you don’t have so many patterns it can still become tedious to have to manually
create the pattern every time a new test is added or modified, wouldn’t it be nice if
the pattern just created itself?!</p>

      <p>With Origen this is possible as long as your patterns lend themselves to being fully described
by a naming convention. In short if it is possible to uniquely describe your pattern behavior
with a name then it is possible to synthesize that pattern from that name - this is goal of
sourceless pattern generation with Origen.</p>

      <p>This feature is particularly powerful when combined with the
<a href="/origen/guides/program/introduction">Origen program generator</a>, since it means that
your test program flow file becomes the only place where you define a test and the program
generator will output a list of required pattern names. This can then be passed to the pattern
generator which can synthesize all of the patterns without needing to create any pattern
sources at all.
Once you have invested some time in building a test program interface and sourceless
pattern capability you can get to the point where to create a new test all you need to do
is add a single line to the test flow and you are done! That level of automation and
efficiency is simply not possible from any other test engineering framework.</p>

      <div>    
  <a class="anchor" name="Enabling_Name-Based_Generation"></a>          
  <h4><a href="#Enabling_Name-Based_Generation">Enabling Name-Based Generation</a></h4>          
</div>

      <p>This feature is enabled via the <code>before_pattern_lookup</code>
<a href="/origen/guides/misc/callbacks">callback</a> which will be called immediately
before Origen looks for a pattern source for the given pattern generation request.
If this method returns false then Origen will cease processing that pattern and will
assume that the application has dealt with the request. If the method returns
the requested pattern name then the regular pattern lookup and generation flow
will proceed as normal.</p>

      <p>It is recommended that you create a dedicated class called a pattern dispatcher within
your application which will handle deciding whether or not a pattern request
can be synthesized without a source file and then if so handle the synthesis and
generation.</p>

      <p>Add these lines to your <code>application.rb</code> file to engage a pattern dispatcher
(where MyApp is your application’s namespace):</p>

      <div class="language-ruby highlighter-coderay">
<div class="CodeRay">
  <div class="code"><pre><span style="color:#777"># config/application.rb</span>
<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">before_pattern_lookup</span>(requested_pattern)
  <span style="color:#036;font-weight:bold">MyApp</span>::<span style="color:#036;font-weight:bold">PatternDispatcher</span>.new.dispatch_or_return(requested_pattern)
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
      </div>

      <p>Then create an initial pattern dispatcher shell like this:</p>

      <div class="language-ruby highlighter-coderay">
<div class="CodeRay">
  <div class="code"><pre><span style="color:#777"># lib/my_app/pattern_dispatcher.rb</span>
<span style="color:#080;font-weight:bold">module</span> <span style="color:#B06;font-weight:bold">MyApp</span>
  <span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">PatternDispatcher</span>

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">dispatch_or_return</span>(requested_pattern)
      requested_pattern
    <span style="color:#080;font-weight:bold">end</span>

  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
      </div>

      <p>This initial dispatcher simply returns the requested pattern name, therefore Origen will
behave as normal and look for a source file for every pattern request.</p>

      <p>Even if you adopt sourceless pattern generation for your application it is likely that
you will still want to support conventional generation as well - having the ability
to quickly hack together a engineering pattern at short notice is something that is
most easily achieved by making a dedicated pattern source file.</p>

      <p>So the first question is what should be the default behavior - sourceless or lookup?</p>

      <p>If sourceless is the default then you can implement a convention where if a pattern
name contains ‘custom’ then a source file will be expected. If lookup is the default
then you could have the opposite convention where ‘nosrc’ in the pattern name means
that it should be generated without a source.</p>

      <p>Let’s go with sourceless being the default, here is how to modify the <code>dispatch_or_return</code>
method to do that:</p>

      <div class="language-ruby highlighter-coderay">
<div class="CodeRay">
  <div class="code"><pre><span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">dispatch_or_return</span>(requested_pattern)
  <span style="color:#777"># If the pattern name contains 'custom' just return the name to have Origen lookup a source file for it</span>
  <span style="color:#080;font-weight:bold">if</span> requested_pattern =~ <span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">custom</span><span style="color:#404">/</span></span>
    requested_pattern
  <span style="color:#080;font-weight:bold">else</span>
    generate(requested_pattern)
    <span style="color:#069">false</span>   <span style="color:#777"># Return false to Origen to prevent std pattern dispatch</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">generate</span>(requested_pattern)
  <span style="color:#777"># Logic to generate the pattern to be added here</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
      </div>

      <p>Now you can see the influence of the pattern dispatcher for the first time, any requests
containing ‘custom’ will be processed as normal and any requests without this will
do nothing.</p>

      <div>    
  <a class="anchor" name="How_to_Generate_a_Pattern"></a>          
  <h4><a href="#How_to_Generate_a_Pattern">How to Generate a Pattern</a></h4>          
</div>

      <p>A pattern can be generated from within the dispatcher in much the same way as it is
generated within a regular pattern source file.</p>

      <p>Here our <code>generate</code> method will now produce an empty pattern:</p>

      <div class="language-ruby highlighter-coderay">
<div class="CodeRay">
  <div class="code"><pre><span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">generate</span>(requested_pattern)
  <span style="color:#036;font-weight:bold">Pattern</span>.create(<span style="color:#606">name</span>: requested_pattern) <span style="color:#080;font-weight:bold">do</span>
    <span style="color:#777"># Logic to generate the pattern to be added here</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
      </div>

      <p>Within the <code>Pattern.create</code> block you can call the exact same methods
that you would use in a regular pattern source, the difference of course is that
here we want to dynamically create them based on the name rather than hard-coding
them for a specific pattern.</p>

      <p>By going this route you also have to currently pick up a bit more responsibility
for pre-processing the requested pattern name. For example via the regular
dispatch mechanism Origen will clean up the name to remove things like a path,
file extension, and pre and post-fixes that may or may not be present. In other
words Origen allows you to very flexible over what name you request, for example
these are equivalent:</p>

      <div class="language-text highlighter-coderay">
<div class="CodeRay">
  <div class="code"><pre>origen g bistcom
origen g output/p2/nvm_bistcom_debug.atp
</pre></div>
</div>
      </div>

      <p>In due course the internal Origen methods may be exposed via an API, but for now
your pattern dispatcher will have to deal with it (if you want to continue to
have this flexibility).</p>

      <p>Here is an example method that you can use for this:</p>

      <div class="language-ruby highlighter-coderay">
<div class="CodeRay">
  <div class="code"><pre><span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">generate</span>(requested_pattern)
  requested_pattern = clean_pattern_name(requested_pattern)
  <span style="color:#036;font-weight:bold">Pattern</span>.create(<span style="color:#606">name</span>: requested_pattern) <span style="color:#080;font-weight:bold">do</span>
    <span style="color:#777"># Logic to generate the pattern to be added here</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">clean_pattern_name</span>(name)
  name = <span style="color:#036;font-weight:bold">Pathname</span>.new(name).basename.to_s  <span style="color:#777"># Strip path</span>
  name.sub!(<span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#D20">\.</span><span style="color:#808">.*</span><span style="color:#404">/</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#710">"</span></span>)    <span style="color:#777"># Strip any and all extensions</span>
  name.sub!(<span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">^nvm_</span><span style="color:#404">/</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#710">"</span></span>)   <span style="color:#777"># Strip prefix, this will unique to your app, here 'nvm_' is removed</span>
  name.sub!(<span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">_debug$</span><span style="color:#404">/</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#710">"</span></span>) <span style="color:#777"># Strip postfix, again unique to your app, here '_debug' occurring at the end is removed</span>
  name
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
      </div>

      <p>Now you should be able to create (albeit empty) patterns via your dispatcher in the
same way as via the regular generator.</p>

      <div>    
  <a class="anchor" name="Renaming_Your_Patterns_to_Make_Parsing_Easier"></a>          
  <h4><a href="#Renaming_Your_Patterns_to_Make_Parsing_Easier">Renaming Your Patterns to Make Parsing Easier</a></h4>          
</div>

      <p>To generate patterns by name you obviously need to have a comprehensive naming convention
from which the behavior of each pattern can be fully described, you may even have
this already in place.</p>

      <p>However what is easy for a human to parse from a naming convention is not necessarily
easy for a computer.
For example your patterns may have the general format:</p>

      <div class="language-text highlighter-coderay">
<div class="CodeRay">
  <div class="code"><pre>&lt;parameter set&gt;_&lt;operation&gt;_&lt;identifier&gt;_&lt;block&gt;
</pre></div>
</div>
      </div>

      <p>Here are a couple of examples:</p>

      <div class="language-text highlighter-coderay">
<div class="CodeRay">
  <div class="code"><pre>prb_pgm_ckbd_b0   # Program a checkerboard to block 0, using probe parameters
ft_pgm_ckbd_b0    # Program a checkerboard to block 0, using FT parameters
</pre></div>
</div>
      </div>

      <p>That’s fine, but what if these are allowed:</p>

      <div class="language-text highlighter-coderay">
<div class="CodeRay">
  <div class="code"><pre>pgm_ckbd_b0       # Program a checkerboard to block 0, using default parameters
pgm_ckbd_20us_b0  # Program a checkerboard to block 0, using default parameters + 20us programming time
</pre></div>
</div>
      </div>

      <p>Again easy enough to understand, but we have just introduced somethings that will be
difficult to interpret by our pattern dispatcher. Firstly how do we know if ‘pgm’
is a reference to an operation or a parameter set?</p>

      <p>One initial way to deal with it is to say that unspecified defaults are not allowed,
but that would quickly get out of hand as it would mean that every pattern would need
to declare every variable which is not realistic. So we need a way to unambiguously say
from the pattern name what each field represents.</p>

      <p>Similarly in the 2nd example we have further qualified the program operation with ‘20us’,
but again this is going to add a lot of complexity to our parser - what does that field
really represent? Is it program time, settling time, something else? Once again attaching
something to the field name is going to really help us out when it comes to parsing and
generating the pattern.</p>

      <p>So how can we re-write these examples to make our lives easier. Well one of the existing
fields already has a good example for us. In the patterns above we have ‘b0’ which has
unwittingly created the convention that a block reference within a pattern will consist
of ‘b’ followed by a number. This is exactly the kind of thing that we can deal with easily.</p>

      <p>So extending that convention to prefix each field with a short mnemonic describing what it
refers to we end up with:</p>

      <div class="language-text highlighter-coderay">
<div class="CodeRay">
  <div class="code"><pre>paraprb_oppgm_patckbd_b0 # Program a checkerboard to block 0, using probe parameters
paraft_oppgm_patckbd_b0  # Program a checkerboard to block 0, using FT parameters
oppgm_patckbd_b0         # Program a checkerboard to block 0, using default parameters
oppgm_patckbd_tprog20_b0 # Program a checkerboard to block 0, using default parameters + 20us programming time
</pre></div>
</div>
      </div>

      <p>So we have paid a penalty here with a pattern name that is a bit more verbose than it really
needs to be, but it is a small price to pay for being able to drop pattern sources
completely and to end up with a relatively simple pattern dispatcher.</p>

      <div>    
  <a class="anchor" name="Parsing_the_Pattern_Name"></a>          
  <h4><a href="#Parsing_the_Pattern_Name">Parsing the Pattern Name</a></h4>          
</div>

      <p>To create an automated pattern dispatcher you are going to have to get familiar with
regular expressions (regexs). Providing a tutorial on this is beyond the scope of this guide, but
a Google search for ‘regular expression tutorial’ should yield many resources to learn
from.</p>

      <p>The following website is highly recommended to keep close by while developing your
dispatcher - <a href="http://www.rubular.com">www.rubular.com</a>. Aside from having a quick reference
guide to the Ruby regex syntax it has a live panel which you can paste in your pattern name
and then experiment with the regex to ensure the correct thing is matched.
Best of all you can even save a given regex setup and
paste the link into into your code comments for future reference.</p>

      <p>The parsing methods you will need to implement are very much dependent on your application and
naming convention, however a good way to get started is to
define a method to handle each field. This breaks down the parsing into manageable chunks
and also gives you a convenient place to set defaults.
Here are some examples
(here assuming that the requested pattern
has been assigned to an instance variable by upstream code):</p>

      <div class="language-ruby highlighter-coderay">
<div class="CodeRay">
  <div class="code"><pre><span style="color:#777"># An example of a required field</span>
<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">operation</span>
  <span style="color:#080;font-weight:bold">if</span> <span style="color:#33B">@requested_pattern</span> =~ <span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">(^|_)op(</span><span style="color:#D20">\w</span><span style="color:#808">+?)(_|$)</span><span style="color:#404">/</span></span>
    <span style="color:#d70">$2</span>
  <span style="color:#080;font-weight:bold">else</span>
    raise <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">No operation was contained in pattern: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span><span style="color:#33B">@requested_pattern</span><span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">"</span></span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

<span style="color:#777"># An example of an optional field with a default</span>
<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">parameter_set</span>
  <span style="color:#080;font-weight:bold">if</span> <span style="color:#33B">@requested_pattern</span> =~ <span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">(^|_)para(</span><span style="color:#D20">\w</span><span style="color:#808">+?)(_|$)</span><span style="color:#404">/</span></span>
    <span style="color:#d70">$2</span>
  <span style="color:#080;font-weight:bold">else</span>
    <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">default</span><span style="color:#710">"</span></span>   <span style="color:#777"># Use the 'default' parameter set if not specified</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

<span style="color:#777"># An example of an optional field that returns nil if not present, a default</span>
<span style="color:#777"># may or may not be assigned later within the patgen logic</span>
<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">block</span>
  <span style="color:#080;font-weight:bold">if</span> <span style="color:#33B">@requested_pattern</span> =~ <span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">(^|_)b(</span><span style="color:#D20">\w</span><span style="color:#808">+?)(_|$)</span><span style="color:#404">/</span></span>
    <span style="color:#d70">$2</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
      </div>

      <p>No doubt the regex code may look a bit daunting at first and unfortunately regexs are
unusual in that they tend to be easier to write than they are to read!
However we have basically used the same regex in all of the above examples and most likely
you could parse your entire pattern name like that.</p>

      <p>Here is a walkthrough of how it works:</p>

      <div>
  <p>
    <code> string =~ // </code> This is basic format of a regex, you can read this as
    "does some section of the string match the rules inside //".
  </p>
  <p>
    <code>/(^|_)para(\w+?)(_|$)/</code>
    This means the start of the string (<code>^</code>) or an underscore...
  </p>
  <p>
    <code>/(^|_)para(\w+?)(_|$)/</code>
    ...followed by the op code that we are trying to match.
  </p>
  <p>
    <code>/(^|_)para(\w+?)(_|$)/</code>
    Then we have the section that we want to capture. <code>\w</code> means a
    word character, that is a letter, number or unfortunately an underscore.
    The <code>+</code> means one or more of the previous characters. Since the
    <code>\w</code> rule includes underscores by default this will match as many
    occurences as possible, so it would continue matching through the next underscore
    and into the next field, this is called a 'greedy' match. To prevent this we
    add the <code>?</code> which tells it to match as little as possible, sometimes
    called a 'lazy' match.
    This whole section is surrounded in parenthesis which means 'capture the values
    that correspond to this section'.
  </p>
  <p>
    <code>/(^|_)para(\w+?)(_|$)/</code>
    Finally stop at the end of the string (<code>$</code>) or an underscore.
  </p>
</div>

      <p>Our regex contains 3 sets of parenthesis, the part of the string that matched this
section is available at the end via the variables <code>$1</code>, <code>$2</code>
and <code>$3</code>. The field we want to capture is in position two and therefore
our parse methods return this.</p>

      <p>Here are links to see each of these in action and for you to experiment with:</p>

      <ul>
        <li><a href="http://www.rubular.com/r/VNrfGJMifl">operation</a></li>
        <li><a href="http://www.rubular.com/r/VN6Bj5MqPg">parameter_set</a></li>
        <li><a href="http://www.rubular.com/r/s7pdwIdxVJ">block</a></li>
      </ul>

      <p>As a final optimization note, with ruby parameters can be used in regexs in the same
way they can be used as strings, so actually we could abstract the regex portion of the
code to a method like this:</p>

      <div class="language-ruby highlighter-coderay">
<div class="CodeRay">
  <div class="code"><pre><span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">extract</span>(op_code)
  <span style="color:#080;font-weight:bold">if</span> <span style="color:#33B">@requested_pattern</span> =~ <span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">(^|_)</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>op_code<span style="font-weight:bold;color:#666">}</span></span><span style="color:#808">(</span><span style="color:#D20">\w</span><span style="color:#808">+?)(_|$)</span><span style="color:#404">/</span></span>
    <span style="color:#d70">$2</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">operation</span>
  extract(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">op</span><span style="color:#710">"</span></span>) || raise(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">No operation was contained in pattern: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span><span style="color:#33B">@requested_pattern</span><span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">"</span></span>)
<span style="color:#080;font-weight:bold">end</span>

<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">parameter_set</span>
  extract(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">para</span><span style="color:#710">"</span></span>) || <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">default</span><span style="color:#710">"</span></span>
<span style="color:#080;font-weight:bold">end</span>

<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">block</span>
  extract(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">b</span><span style="color:#710">"</span></span>)
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
      </div>

      <div>    
  <a class="anchor" name="Putting_it_All_Together"></a>          
  <h4><a href="#Putting_it_All_Together">Putting it All Together</a></h4>          
</div>

      <p>Now that we can generate a list of build options from the requested name we can start to
generate the pattern.</p>

      <p>One of the first jobs of the dispatcher is to generate the list of options
that should be passed into <code>Pattern.create</code>, in our example let’s say that
the parameter set option is passed into our startup method via <code>Pattern.create</code>.</p>

      <p>We can now do this by simply calling our <code>parameter_set</code> method:</p>

      <div class="language-ruby highlighter-coderay">
<div class="CodeRay">
  <div class="code"><pre><span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">generate</span>(requested_pattern)
  requested_pattern = clean_pattern_name(requested_pattern)
  <span style="color:#036;font-weight:bold">Pattern</span>.create(<span style="color:#606">name</span>: requested_pattern, <span style="color:#606">parameter_set</span>: parameter_set) <span style="color:#080;font-weight:bold">do</span>
    <span style="color:#777"># Logic to generate the pattern to be added here</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
      </div>

      <p>What happens inside the pattern block very much depends on your application patgen API
and if you are creating this from scratch
some thought should be given to designing it to lend itself to pattern synthesis.
In the flagship Origen application where this technique was first developed the original
API was not at all designed with this in mind. This led to an extremely complex pattern
dispatcher being required to handle all of the corner cases.</p>

      <p>To make life simpler for pattern synthesis it is recommended that the API is kept very simple
with only a few methods being made available and all customization of the operation being
done via an options hash.</p>

      <p>So for example a good API to handle our program checkerboard example might be:</p>

      <div class="language-ruby highlighter-coderay">
<div class="CodeRay">
  <div class="code"><pre><span style="color:#036;font-weight:bold">Pattern</span>.create(<span style="color:#606">params</span>: <span style="color:#A60">:ft</span>) <span style="color:#080;font-weight:bold">do</span>
  <span style="color:#d70">$dut</span>.nvm.pgm(<span style="color:#606">pattern</span>: <span style="color:#A60">:ckbd</span>, <span style="color:#606">tprog</span>: <span style="color:#00D">20</span>, <span style="color:#606">block</span>: <span style="color:#00D">0</span>)
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
      </div>

      <p>Which could then be synthesized via the following method:</p>

      <div class="language-ruby highlighter-coderay">
<div class="CodeRay">
  <div class="code"><pre><span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">generate</span>(requested_pattern)
  requested_pattern = clean_pattern_name(requested_pattern)
  <span style="color:#036;font-weight:bold">Pattern</span>.create(<span style="color:#606">name</span>: requested_pattern, <span style="color:#606">parameter_set</span>: parameter_set) <span style="color:#080;font-weight:bold">do</span>
    <span style="color:#d70">$dut</span>.nvm.send operation, <span style="color:#606">pattern</span>: pattern,
                             <span style="color:#606">tprog</span>: tprog,
                             <span style="color:#606">block</span>: block
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
      </div>

      <p>Even simpler would be:</p>

      <div class="language-ruby highlighter-coderay">
<div class="CodeRay">
  <div class="code"><pre><span style="color:#036;font-weight:bold">Pattern</span>.create(<span style="color:#606">params</span>: <span style="color:#A60">:ft</span>) <span style="color:#080;font-weight:bold">do</span>
  <span style="color:#d70">$dut</span>.nvm.execute(<span style="color:#606">operation</span>: <span style="color:#A60">:pgm</span>, <span style="color:#606">pattern</span>: <span style="color:#A60">:ckbd</span>, <span style="color:#606">tprog</span>: <span style="color:#00D">20</span>, <span style="color:#606">block</span>: block)
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
      </div>

      <p>And the equivalent synthesizer method:</p>

      <div class="language-ruby highlighter-coderay">
<div class="CodeRay">
  <div class="code"><pre><span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">generate</span>(requested_pattern)
  requested_pattern = clean_pattern_name(requested_pattern)
  <span style="color:#036;font-weight:bold">Pattern</span>.create(<span style="color:#606">name</span>: requested_pattern, <span style="color:#606">parameter_set</span>: parameter_set) <span style="color:#080;font-weight:bold">do</span>
    <span style="color:#d70">$dut</span>.nvm.execute <span style="color:#606">operation</span>: operation,
                     <span style="color:#606">pattern</span>: pattern,
                     <span style="color:#606">tprog</span>: tprog,
                     <span style="color:#606">block</span>: block
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
      </div>

      <p>A clear pattern is starting to emerge now that for every supported option we have
a matching method of the same name in our dispatcher, so we can optimize this a bit:</p>

      <div class="language-ruby highlighter-coderay">
<div class="CodeRay">
  <div class="code"><pre><span style="color:#036;font-weight:bold">OPTIONS</span> = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">%w(</span><span style="color:#D20">operation pattern tprog block</span><span style="color:#710">)</span></span>

<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">generate</span>(requested_pattern)
  requested_pattern = clean_pattern_name(requested_pattern)
  options = {}
  <span style="color:#036;font-weight:bold">OPTIONS</span>.each <span style="color:#080;font-weight:bold">do</span> |option|
    options[<span style="color:#A60">:option</span>] = <span style="color:#069">self</span>.send(option)
  <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#036;font-weight:bold">Pattern</span>.create(<span style="color:#606">name</span>: requested_pattern, <span style="color:#606">parameter_set</span>: parameter_set) <span style="color:#080;font-weight:bold">do</span>
    <span style="color:#d70">$dut</span>.nvm.execute(options) 
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
      </div>

      <p>Now if we want to add support for a new option we just add it to the <code>OPTIONS</code>
array and create the corresponding parse method.</p>

      <p>We can probably go one better.</p>

      <p>As we have seen the parser methods are all very similar, do we really need them?</p>

      <p>Not really as long as we are willing to defer default setting and error checking to our
models (where it probably makes more sense anyway).</p>

      <p>Here is a complete pattern dispatcher in around 30 lines of code, where if you want to
add support for another field in the future just add it to the <code>OPTIONS</code>
definition that maps the option name to the pattern name op code:</p>

      <div class="language-ruby highlighter-coderay">
<div class="CodeRay">
  <div class="code"><pre><span style="color:#777"># lib/my_app/pattern_dispatcher.rb</span>
<span style="color:#080;font-weight:bold">module</span> <span style="color:#B06;font-weight:bold">MyApp</span>
  <span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">PatternDispatcher</span>

    <span style="color:#036;font-weight:bold">OPTIONS</span> = {
      <span style="color:#606">operation</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">op</span><span style="color:#710">"</span></span>,
      <span style="color:#606">pattern</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">pat</span><span style="color:#710">"</span></span>,
      <span style="color:#606">tprog</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">tprog</span><span style="color:#710">"</span></span>,
      <span style="color:#606">block</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">b</span><span style="color:#710">"</span></span>,
    }

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">generate</span>(requested_pattern)
      <span style="color:#33B">@requested_pattern</span> = clean_pattern_name(requested_pattern)
      options = {}
      <span style="color:#036;font-weight:bold">OPTIONS</span>.each <span style="color:#080;font-weight:bold">do</span> |option, op_code|
        options[<span style="color:#A60">:option</span>] = extract(op_code)
      <span style="color:#080;font-weight:bold">end</span>
      <span style="color:#036;font-weight:bold">Pattern</span>.create(<span style="color:#606">name</span>: <span style="color:#33B">@requested_pattern</span>, <span style="color:#606">parameter_set</span>: extract(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">para</span><span style="color:#710">"</span></span>)) <span style="color:#080;font-weight:bold">do</span>
        <span style="color:#d70">$dut</span>.nvm.execute(options) 
      <span style="color:#080;font-weight:bold">end</span>
    <span style="color:#080;font-weight:bold">end</span>

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">extract</span>(op_code)
      <span style="color:#080;font-weight:bold">if</span> <span style="color:#33B">@requested_pattern</span> =~ <span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">(^|_)</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>op_code<span style="font-weight:bold;color:#666">}</span></span><span style="color:#808">(</span><span style="color:#D20">\w</span><span style="color:#808">+?)(_|$)</span><span style="color:#404">/</span></span>
        <span style="color:#d70">$2</span>
      <span style="color:#080;font-weight:bold">end</span>
    <span style="color:#080;font-weight:bold">end</span>

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">dispatch_or_return</span>(requested_pattern)
      <span style="color:#777"># If the pattern name contains 'custom' just return the name to have Origen lookup a source file for it</span>
      <span style="color:#080;font-weight:bold">if</span> requested_pattern =~ <span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">custom</span><span style="color:#404">/</span></span>
        requested_pattern
      <span style="color:#080;font-weight:bold">else</span>
        generate(requested_pattern)
        <span style="color:#069">false</span>   <span style="color:#777"># Return false to Origen to prevent std pattern dispatch</span>
      <span style="color:#080;font-weight:bold">end</span>
    <span style="color:#080;font-weight:bold">end</span>

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">clean_pattern_name</span>(name)
      name = <span style="color:#036;font-weight:bold">Pathname</span>.new(name).basename.to_s  <span style="color:#777"># Strip path</span>
      name.sub!(<span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#D20">\.</span><span style="color:#808">.*</span><span style="color:#404">/</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#710">"</span></span>)    <span style="color:#777"># Strip any and all extensions</span>
      name.sub!(<span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">^nvm_</span><span style="color:#404">/</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#710">"</span></span>)   <span style="color:#777"># Strip prefix, this will unique to your app, here 'nvm_' is removed</span>
      name.sub!(<span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">_debug$</span><span style="color:#404">/</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#710">"</span></span>) <span style="color:#777"># Strip postfix, again unique to your app, here '_debug' occurring at the end is removed</span>
      name
    <span style="color:#080;font-weight:bold">end</span>

  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
      </div>

      <div style="position: relative">
  <hr>
  <div>    
  <a class="anchor" name="Comments"></a>          
  <h4><a href="#Comments">Comments</a></h4>          
</div>
</div>
      <div id="disqus_thread"></div>
      <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'origen-sdk';
    var disqus_title;
    var disqus_url = 'http://' + window.location.hostname + window.location.pathname;

    disqus_title = $("h1").text();
    if (disqus_title.length == 0) {
      disqus_title = $("h2").text();
    }
    if (disqus_title.length == 0) {
      disqus_title = $("h3").text();
    }
    if (disqus_title.length == 0) {
      disqus_title = $("title").text();
    } else {
      disqus_title = disqus_title + ' (' + $("title").text() + ')';
    }

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

      <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>

    </article>
  </div>
</div>

<script src="/origen/search.js"></script>


      </div><!-- /.container -->
    

    <footer class="footer">
      <div class="container">
        <p class="pull-left text-muted">
          Generated with the <a href="http://origen-sdk.org">Origen Semiconductor Developer's Kit</a>
        </p>
        <p class="pull-right text-muted">Origen is released under the terms of the <a href="https://choosealicense.com/licenses/mit/">MIT license</a></p>
      </div>
    </footer>
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script src="http://origen-sdk.org/js/lunr.min.js"></script>
    <script src="http://origen-sdk.org/js/highlight.js"></script>
    <script src="http://origen-sdk.org/js/custom.js"></script>
    
      <script>
        ((window.gitter = {}).chat = {}).options = {
          room: 'Origen-SDK/users'
        };
      </script>
      <script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>
    
  </body>
</html>
