<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: OrigenJTAG::Driver
  
    &mdash; Origen JTAG 0.17.2
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "OrigenJTAG::Driver";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (D)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../OrigenJTAG.html" title="OrigenJTAG (module)">OrigenJTAG</a></span></span>
     &raquo; 
    <span class="title">Driver</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: OrigenJTAG::Driver
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">OrigenJTAG::Driver</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  <dl>
      <dt>Includes:</dt>
      <dd>Origen::Registers, <span class='object_link'><a href="TAPController.html" title="OrigenJTAG::TAPController (module)">TAPController</a></span></dd>
  </dl>
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/origen_jtag/driver.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>This driver provides methods to read and write from a JTAG instruction and
data registers.</p>

<p>Low level methods are also provided for fine control of the TAP Controller
state machine via the TAPController module.</p>

<p>To use this driver the parent model must define the following pins (an
alias is fine):</p>

<pre class="code ruby"><code class="ruby"><span class='symbol'>:tclk</span>
<span class='symbol'>:tdi</span>
<span class='symbol'>:tdo</span>
<span class='symbol'>:tms</span>
</code></pre>


  </div>
</div>
<div class="tags">
  

</div>
  <h2>Constant Summary</h2>
  <dl class="constants">
    
      <dt id="REQUIRED_PINS-constant" class="">REQUIRED_PINS =
        
      </dt>
      <dd><pre class="code"><span class='lbracket'>[</span><span class='symbol'>:tclk</span><span class='comma'>,</span> <span class='symbol'>:tdi</span><span class='comma'>,</span> <span class='symbol'>:tdo</span><span class='comma'>,</span> <span class='symbol'>:tms</span><span class='rbracket'>]</span></pre></dd>
    
  </dl>



  
  
  <h3 class="inherited">Constants included
     from <span class='object_link'><a href="TAPController.html" title="OrigenJTAG::TAPController (module)">TAPController</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="TAPController.html#STATES-constant" title="OrigenJTAG::TAPController::STATES (constant)">TAPController::STATES</a></span></p>


  <h2>Instance Attribute Summary <small><a href="#" class="summary_toggle">collapse</a></small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#ir_value-instance_method" title="#ir_value (instance method)">#<strong>ir_value</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the current value in the instruction register.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#log_state_changes-instance_method" title="#log_state_changes (instance method)">#<strong>log_state_changes</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Log all state changes in pattern comments, false by default.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#owner-instance_method" title="#owner (instance method)">#<strong>owner</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the object that instantiated the JTAG.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#tclk_format-instance_method" title="#tclk_format (instance method)">#<strong>tclk_format</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute tclk_format.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#verbose-instance_method" title="#verbose (instance method)">#<strong>verbose</strong>  &#x21d2; Object </a>
    

    
      (also: #verbose?)
    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Set true to print out debug comments about all state transitions.</p>
</div></span>
  
</li>

    
  </ul>



  
  
  <h3 class="inherited">Attributes included from <span class='object_link'><a href="TAPController.html" title="OrigenJTAG::TAPController (module)">TAPController</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="TAPController.html#state-instance_method" title="OrigenJTAG::TAPController#state (method)">#state</a></span></p>


  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(owner, options = {})  &#x21d2; Driver </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>A new instance of Driver.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#read_dr-instance_method" title="#read_dr (instance method)">#<strong>read_dr</strong>(reg_or_val, options = {})  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Read the given value, register or bit collection from the data register.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#read_ir-instance_method" title="#read_ir (instance method)">#<strong>read_ir</strong>(reg_or_val, options = {})  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Read the given value, register or bit collection from the instruction
register.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#shift-instance_method" title="#shift (instance method)">#<strong>shift</strong>(reg_or_val, options = {})  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Shift data into the TDI pin or out of the TDO pin.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#tclk_cycle-instance_method" title="#tclk_cycle (instance method)">#<strong>tclk_cycle</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Cycles the tester through one TCLK cycle Adjusts for the TCLK format and
cycle span Assumes caller will drive pattern to tester via .drive or
similar.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#tms!-instance_method" title="#tms! (instance method)">#<strong>tms!</strong>(val)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Applies the given value to the TMS pin and then cycles the tester for one
TCLK.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#write_dr-instance_method" title="#write_dr (instance method)">#<strong>write_dr</strong>(reg_or_val, options = {})  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Write the given value, register or bit collection to the data register.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#write_ir-instance_method" title="#write_ir (instance method)">#<strong>write_ir</strong>(reg_or_val, options = {})  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Write the given value, register or bit collection to the instruction
register.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="TAPController.html" title="OrigenJTAG::TAPController (module)">TAPController</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="TAPController.html#idle-instance_method" title="OrigenJTAG::TAPController#idle (method)">#idle</a></span>, <span class='object_link'><a href="TAPController.html#pause_dr-instance_method" title="OrigenJTAG::TAPController#pause_dr (method)">#pause_dr</a></span>, <span class='object_link'><a href="TAPController.html#pause_ir-instance_method" title="OrigenJTAG::TAPController#pause_ir (method)">#pause_ir</a></span>, <span class='object_link'><a href="TAPController.html#reset-instance_method" title="OrigenJTAG::TAPController#reset (method)">#reset</a></span>, <span class='object_link'><a href="TAPController.html#shift_dr-instance_method" title="OrigenJTAG::TAPController#shift_dr (method)">#shift_dr</a></span>, <span class='object_link'><a href="TAPController.html#shift_ir-instance_method" title="OrigenJTAG::TAPController#shift_ir (method)">#shift_ir</a></span>, <span class='object_link'><a href="TAPController.html#state_str-instance_method" title="OrigenJTAG::TAPController#state_str (method)">#state_str</a></span>, <span class='object_link'><a href="TAPController.html#update_state-instance_method" title="OrigenJTAG::TAPController#update_state (method)">#update_state</a></span></p>
<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(owner, options = {})  &#x21d2; <tt><span class='object_link'><a href="" title="OrigenJTAG::Driver (class)">Driver</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a new instance of Driver</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/origen_jtag/driver.rb', line 33</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_owner'>owner</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='ivar'>@owner</span> <span class='op'>=</span> <span class='id identifier rubyid_owner'>owner</span>
  <span class='id identifier rubyid_validate_pins'>validate_pins</span>

  <span class='comment'># The parent can configure JTAG settings by defining this constant
</span>  <span class='kw'>if</span> <span class='kw'>defined?</span><span class='lparen'>(</span><span class='id identifier rubyid_owner'>owner</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='op'>::</span><span class='const'>JTAG_CONFIG</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='id identifier rubyid_owner'>owner</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='op'>::</span><span class='const'>JTAG_CONFIG</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Fallback defaults
</span>  <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span>
    <span class='label'>verbose:</span>         <span class='kw'>false</span><span class='comma'>,</span>
    <span class='label'>tclk_format:</span>     <span class='symbol'>:rh</span><span class='comma'>,</span>                <span class='comment'># format of JTAG clock used:  ReturnHigh (:rh), ReturnLo (:rl)
</span>    <span class='label'>tclk_multiple:</span>   <span class='int'>1</span><span class='comma'>,</span>                  <span class='comment'># number of cycles for one clock pulse, assumes 50% duty cycle. Uses tester non-return format to spread TCK across multiple cycles.
</span>    <span class='comment'>#    e.g. @tclk_multiple = 2, @tclk_format = :rh, means one cycle with Tck low (non-return), one with Tck high (NR)
</span>    <span class='comment'>#         @tclk_multiple = 4, @tclk_format = :rl, means 2 cycles with Tck high (NR), 2 with Tck low (NR)
</span>    <span class='label'>tdo_strobe:</span>      <span class='symbol'>:tclk_high</span><span class='comma'>,</span>            <span class='comment'># when using multiple cycles for TCK, when to strobe for TDO, options include:
</span>    <span class='comment'>#     :tclk_high   - strobe TDO only when TCK is high
</span>    <span class='comment'>#     :tclk_low    - strobe TDO only when TCK is low
</span>    <span class='comment'>#     :tclk_all    - strobe TDO throughout TCK cycle
</span>    <span class='label'>tdo_store_cycle:</span> <span class='int'>0</span><span class='comma'>,</span>                <span class='comment'># store vector cycle within TCK (i.e. when to indicate to tester to store vector within TCK cycle.  0 is first vector, 1 is second, etc.)
</span>    <span class='comment'># NOTE: only when user indicates to store TDO, which will mean we don&#39;t care the 1 or 0 value on TDO (overriding effectively :tdo_strobe option above)
</span>    <span class='label'>init_state:</span>      <span class='symbol'>:unknown</span>
  <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_init_tap_controller'>init_tap_controller</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>

  <span class='ivar'>@verbose</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:verbose</span><span class='rbracket'>]</span>
  <span class='ivar'>@ir_value</span> <span class='op'>=</span> <span class='symbol'>:unknown</span>
  <span class='ivar'>@tclk_format</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:tclk_format</span><span class='rbracket'>]</span>
  <span class='ivar'>@tclk_multiple</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:tclk_multiple</span><span class='rbracket'>]</span>
  <span class='ivar'>@tdo_strobe</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:tdo_strobe</span><span class='rbracket'>]</span>
  <span class='ivar'>@tdo_store_cycle</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:tdo_store_cycle</span><span class='rbracket'>]</span>
  <span class='ivar'>@state</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:init_state</span><span class='rbracket'>]</span>
  <span class='ivar'>@log_state_changes</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:log_state_changes</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='kw'>false</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="ir_value-instance_method">
  
    #<strong>ir_value</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the current value in the instruction register</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


23
24
25</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/origen_jtag/driver.rb', line 23</span>

<span class='kw'>def</span> <span class='id identifier rubyid_ir_value'>ir_value</span>
  <span class='ivar'>@ir_value</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="log_state_changes=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="log_state_changes-instance_method">
  
    #<strong>log_state_changes</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Log all state changes in pattern comments, false by default</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


31
32
33</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/origen_jtag/driver.rb', line 31</span>

<span class='kw'>def</span> <span class='id identifier rubyid_log_state_changes'>log_state_changes</span>
  <span class='ivar'>@log_state_changes</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="owner-instance_method">
  
    #<strong>owner</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the object that instantiated the JTAG</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


20
21
22</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/origen_jtag/driver.rb', line 20</span>

<span class='kw'>def</span> <span class='id identifier rubyid_owner'>owner</span>
  <span class='ivar'>@owner</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="tclk_format=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="tclk_format-instance_method">
  
    #<strong>tclk_format</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute tclk_format</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


25
26
27</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/origen_jtag/driver.rb', line 25</span>

<span class='kw'>def</span> <span class='id identifier rubyid_tclk_format'>tclk_format</span>
  <span class='ivar'>@tclk_format</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="verbose=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="verbose-instance_method">
  
    #<strong>verbose</strong>  &#x21d2; <tt>Object</tt> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='verbose?-instance_method'>verbose?</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Set true to print out debug comments about all state transitions</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


27
28
29</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/origen_jtag/driver.rb', line 27</span>

<span class='kw'>def</span> <span class='id identifier rubyid_verbose'>verbose</span>
  <span class='ivar'>@verbose</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="read_dr-instance_method">
  
    #<strong>read_dr</strong>(reg_or_val, options = {})  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Read the given value, register or bit collection from the data register.
This is a self contained method that will take care of the TAP controller
state transitions, exiting with the TAP controller in Run-Test/Idle.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>reg_or_val</span>
      
      
        <span class='type'>(<tt>Integer</tt>, <tt>Origen::Register::Reg</tt>, <tt>Origen::Register::BitCollection</tt>, <tt>Origen::Register::Bit</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Value to be read. If a reg/bit collection is supplied this can be
pre-marked for read in which case only the marked bits will be read and the
vectors corresponding to the data from the non-read bits will be set to
don&#39;t care. Similarly the bits can be pre-marked for store (capture) or
overlay.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Options to customize the operation</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:size</span>
          <span class="type">(<tt>Integer</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The number of bits to read. This is optional when supplying a register or
bit collection in which case the size will be derived from the number of
bits supplied. If the size is supplied then it will override the size
derived from the bits. If the size is greater than the number of bits
provided then the additional space will be padded by don&#39;t care cycles.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:msg</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>By default will not make any comments directly here.  Can pass a msg to be
written out prior to shifting data.</p>
</div>
          
        </li>
      
    </ul>
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


395
396
397
398
399
400
401
402
403
404
405
406
407
408
409</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/origen_jtag/driver.rb', line 395</span>

<span class='kw'>def</span> <span class='id identifier rubyid_read_dr'>read_dr</span><span class='lparen'>(</span><span class='id identifier rubyid_reg_or_val'>reg_or_val</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='const'>Origen</span><span class='period'>.</span><span class='id identifier rubyid_tester'>tester</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:read_dr</span><span class='rparen'>)</span>
    <span class='const'>Origen</span><span class='period'>.</span><span class='id identifier rubyid_tester'>tester</span><span class='period'>.</span><span class='id identifier rubyid_read_dr'>read_dr</span><span class='lparen'>(</span><span class='id identifier rubyid_reg_or_val'>reg_or_val</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span>
      <span class='label'>read:</span> <span class='kw'>true</span>
    <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:msg</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_cc'>cc</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:msg</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_shift_dr'>shift_dr</span><span class='lparen'>(</span><span class='label'>read:</span> <span class='const'>Origen</span><span class='op'>::</span><span class='const'>Utility</span><span class='period'>.</span><span class='id identifier rubyid_read_hex'>read_hex</span><span class='lparen'>(</span><span class='id identifier rubyid_reg_or_val'>reg_or_val</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_shift'>shift</span><span class='lparen'>(</span><span class='id identifier rubyid_reg_or_val'>reg_or_val</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="read_ir-instance_method">
  
    #<strong>read_ir</strong>(reg_or_val, options = {})  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Read the given value, register or bit collection from the instruction
register. This is a self contained method that will take care of the TAP
controller state transitions, exiting with the TAP controller in
Run-Test/Idle.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>reg_or_val</span>
      
      
        <span class='type'>(<tt>Integer</tt>, <tt>Origen::Register::Reg</tt>, <tt>Origen::Register::BitCollection</tt>, <tt>Origen::Register::Bit</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Value to be read. If a reg/bit collection is supplied this can be
pre-marked for read in which case only the marked bits will be read and the
vectors corresponding to the data from the non-read bits will be set to
don&#39;t care. Similarly the bits can be pre-marked for store (capture) or
overlay.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Options to customize the operation</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:size</span>
          <span class="type">(<tt>Integer</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The number of bits to read. This is optional when supplying a register or
bit collection in which case the size will be derived from the number of
bits supplied. If the size is supplied then it will override the size
derived from the bits. If the size is greater than the number of bits
provided then the additional space will be padded by don&#39;t care cycles.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:msg</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>By default will not make any comments directly here.  Can pass a msg to be
written out prior to shifting data.</p>
</div>
          
        </li>
      
    </ul>
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


465
466
467
468
469
470
471
472
473
474
475
476
477
478
479</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/origen_jtag/driver.rb', line 465</span>

<span class='kw'>def</span> <span class='id identifier rubyid_read_ir'>read_ir</span><span class='lparen'>(</span><span class='id identifier rubyid_reg_or_val'>reg_or_val</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='const'>Origen</span><span class='period'>.</span><span class='id identifier rubyid_tester'>tester</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:read_ir</span><span class='rparen'>)</span>
    <span class='const'>Origen</span><span class='period'>.</span><span class='id identifier rubyid_tester'>tester</span><span class='period'>.</span><span class='id identifier rubyid_read_ir'>read_ir</span><span class='lparen'>(</span><span class='id identifier rubyid_reg_or_val'>reg_or_val</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span>
      <span class='label'>read:</span> <span class='kw'>true</span>
    <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:msg</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_cc'>cc</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:msg</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_shift_ir'>shift_ir</span><span class='lparen'>(</span><span class='label'>read:</span> <span class='const'>Origen</span><span class='op'>::</span><span class='const'>Utility</span><span class='period'>.</span><span class='id identifier rubyid_read_hex'>read_hex</span><span class='lparen'>(</span><span class='id identifier rubyid_reg_or_val'>reg_or_val</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_shift'>shift</span><span class='lparen'>(</span><span class='id identifier rubyid_reg_or_val'>reg_or_val</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="shift-instance_method">
  
    #<strong>shift</strong>(reg_or_val, options = {})  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Shift data into the TDI pin or out of the TDO pin.</p>

<p>There is no TAP controller state checking or handling here, it just shifts
some data directly into the pattern, so it is assumed that some higher
level logic is co-ordinating the TAP Controller.</p>

<p>Most applications should not call this method directly and should instead
use the pre-packaged read/write_dr/ir methods. However it is provided as a
public API for the corner cases like generating an overlay subroutine
pattern where it would be necessary to generate some JTAG vectors outwith
the normal state controller wrapper.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>reg_or_val</span>
      
      
        <span class='type'>(<tt>Integer</tt>, <tt>Origen::Register::Reg</tt>, <tt>Origen::Register::BitCollection</tt>, <tt>Origen::Register::Bit</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Value to be shifted. If a reg/bit collection is supplied this can be
pre-marked for read, store or overlay and which will result in the
requested action being applied to the cycles corresponding to those bits
only (don&#39;t care cycles will be generated for the others).</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Options to customize the operation</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:size</span>
          <span class="type">(<tt>Integer</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The number of bits to shift. This is optional when supplying a register or
bit collection in which case the size will be derived from the number of
bits supplied. If this option is supplied then it will override the size
derived from the bits. If the size is greater than the number of bits
provided then the additional space will be padded by 0s or don&#39;t cares
as appropriate.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:read</span>
          <span class="type">(<tt>Boolean</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          
            &mdash; <div class='inline'>
<p>When true the given value will be compared on the TDO pin instead of being
shifted into the TDI pin. In the case of a register object being provided
only those bits that are actually marked for read will be compared.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:cycle_last</span>
          <span class="type">(<tt>Boolean</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          
            &mdash; <div class='inline'>
<p>Normally the last data bit is applied to the pins but not cycled, this is
to integrate with the TAPController which usually requires that the TMS
value is also changed on the last data bit. To override this default
behavior and force a cycle for the last data bit set this to true.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:includes_last_bit</span>
          <span class="type">(<tt>Boolean</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>true</tt>
            
          </span>
          
            &mdash; <div class='inline'>
<p>When true the TMS pin will be driven to 1 on the last cycle of the shift if
:cycle_last has been specified. To override this and keep TMS low on the
last cycle set this to false. One reason for doing this would be if
generating some subroutine vectors which only represented a partial section
of a shift operation.</p>
</div>
          
        </li>
      
    </ul>
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/origen_jtag/driver.rb', line 104</span>

<span class='kw'>def</span> <span class='id identifier rubyid_shift'>shift</span><span class='lparen'>(</span><span class='id identifier rubyid_reg_or_val'>reg_or_val</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span>
    <span class='label'>read:</span>              <span class='kw'>false</span><span class='comma'>,</span>
    <span class='label'>cycle_last:</span>        <span class='kw'>false</span><span class='comma'>,</span>
    <span class='label'>includes_last_bit:</span> <span class='kw'>true</span><span class='comma'>,</span>
    <span class='label'>no_subr:</span>           <span class='kw'>false</span>      <span class='comment'># do not use subroutine for any overlay
</span>  <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>

  <span class='comment'># save compression state for restoring afterwards
</span>  <span class='id identifier rubyid_compression_on'>compression_on</span> <span class='op'>=</span> <span class='op'>!</span><span class='const'>Origen</span><span class='period'>.</span><span class='id identifier rubyid_tester'>tester</span><span class='period'>.</span><span class='id identifier rubyid_dont_compress'>dont_compress</span>

  <span class='comment'># clean incoming data
</span>  <span class='id identifier rubyid_size'>size</span> <span class='op'>=</span> <span class='id identifier rubyid_extract_size'>extract_size</span><span class='lparen'>(</span><span class='id identifier rubyid_reg_or_val'>reg_or_val</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_tdi_reg'>tdi_reg</span> <span class='op'>=</span> <span class='id identifier rubyid_extract_shift_in_data'>extract_shift_in_data</span><span class='lparen'>(</span><span class='id identifier rubyid_reg_or_val'>reg_or_val</span><span class='comma'>,</span> <span class='id identifier rubyid_size'>size</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_tdo_reg'>tdo_reg</span> <span class='op'>=</span> <span class='id identifier rubyid_extract_shift_out_data'>extract_shift_out_data</span><span class='lparen'>(</span><span class='id identifier rubyid_reg_or_val'>reg_or_val</span><span class='comma'>,</span> <span class='id identifier rubyid_size'>size</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_global_ovl'>global_ovl</span><span class='comma'>,</span> <span class='id identifier rubyid_ovl_reg'>ovl_reg</span> <span class='op'>=</span> <span class='id identifier rubyid_extract_overlay_data'>extract_overlay_data</span><span class='lparen'>(</span><span class='id identifier rubyid_reg_or_val'>reg_or_val</span><span class='comma'>,</span> <span class='id identifier rubyid_size'>size</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>

  <span class='comment'># let the tester handle overlay if possible
</span>  <span class='kw'>unless</span> <span class='id identifier rubyid_tester'>tester</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:source_memory</span><span class='rparen'>)</span>
    <span class='comment'># tester does not support direct labels, so can&#39;t do
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:no_subr</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='gvar'>$tester</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>label</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_cc'>cc</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>This tester does not support use of labels, cannot do no_subr option as requested</span><span class='tstring_end'>&#39;</span></span>
      <span class='id identifier rubyid_cc'>cc</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>  going with subroutine overlay instead</span><span class='tstring_end'>&#39;</span></span>
      <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:no_subr</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='kw'>end</span>

    <span class='comment'># insert global label if specified
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_global_ovl'>global_ovl</span>
      <span class='kw'>if</span> <span class='gvar'>$tester</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>label</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='gvar'>$tester</span><span class='period'>.</span><span class='id identifier rubyid_label'>label</span><span class='lparen'>(</span><span class='id identifier rubyid_global_ovl'>global_ovl</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_cc'>cc</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unsupported global label: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_global_ovl'>global_ovl</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span> <span class='comment'># of let tester handle overlay if possible
</span>
  <span class='comment'># loop through each data bit
</span>  <span class='id identifier rubyid_last_overlay_label'>last_overlay_label</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_size'>size</span><span class='period'>.</span><span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
    <span class='id identifier rubyid_store_tdo_this_tclk'>store_tdo_this_tclk</span> <span class='op'>=</span> <span class='kw'>false</span>

    <span class='comment'># Set up pin actions for bit transaction (tclk cycle)
</span>
    <span class='comment'># TDI
</span>    <span class='id identifier rubyid_owner'>owner</span><span class='period'>.</span><span class='id identifier rubyid_pin'>pin</span><span class='lparen'>(</span><span class='symbol'>:tdi</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_drive'>drive</span><span class='lparen'>(</span><span class='id identifier rubyid_tdi_reg'>tdi_reg</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span><span class='rparen'>)</span>

    <span class='comment'># TDO
</span>    <span class='id identifier rubyid_owner'>owner</span><span class='period'>.</span><span class='id identifier rubyid_pin'>pin</span><span class='lparen'>(</span><span class='symbol'>:tdo</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_dont_care'>dont_care</span>                               <span class='comment'># default setting
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_tdo_reg'>tdo_reg</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_tdo_reg'>tdo_reg</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_is_to_be_stored?'>is_to_be_stored?</span>                        <span class='comment'># store
</span>        <span class='id identifier rubyid_store_tdo_this_tclk'>store_tdo_this_tclk</span> <span class='op'>=</span> <span class='kw'>true</span>
        <span class='id identifier rubyid_owner'>owner</span><span class='period'>.</span><span class='id identifier rubyid_pin'>pin</span><span class='lparen'>(</span><span class='symbol'>:tdo</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_dont_care'>dont_care</span> <span class='kw'>if</span> <span class='const'>Origen</span><span class='period'>.</span><span class='id identifier rubyid_tester'>tester</span><span class='period'>.</span><span class='id identifier rubyid_j750?'>j750?</span>
      <span class='kw'>elsif</span> <span class='id identifier rubyid_tdo_reg'>tdo_reg</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_is_to_be_read?'>is_to_be_read?</span>                       <span class='comment'># compare/assert
</span>        <span class='id identifier rubyid_owner'>owner</span><span class='period'>.</span><span class='id identifier rubyid_pin'>pin</span><span class='lparen'>(</span><span class='symbol'>:tdo</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_assert'>assert</span><span class='lparen'>(</span><span class='id identifier rubyid_tdo_reg'>tdo_reg</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># TMS
</span>    <span class='id identifier rubyid_owner'>owner</span><span class='period'>.</span><span class='id identifier rubyid_pin'>pin</span><span class='lparen'>(</span><span class='symbol'>:tms</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_drive'>drive</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span>

    <span class='comment'># let tester handle overlay if implemented
</span>    <span class='id identifier rubyid_overlay_options'>overlay_options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_tester'>tester</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:source_memory</span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_ovl_reg'>ovl_reg</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_ovl_reg'>ovl_reg</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_has_overlay?'>has_overlay?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='const'>Origen</span><span class='period'>.</span><span class='id identifier rubyid_mode'>mode</span><span class='period'>.</span><span class='id identifier rubyid_simulation?'>simulation?</span>
        <span class='id identifier rubyid_overlay_options'>overlay_options</span><span class='lbracket'>[</span><span class='symbol'>:pins</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_owner'>owner</span><span class='period'>.</span><span class='id identifier rubyid_pin'>pin</span><span class='lparen'>(</span><span class='symbol'>:tdi</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_global_ovl'>global_ovl</span>
          <span class='id identifier rubyid_overlay_options'>overlay_options</span><span class='lbracket'>[</span><span class='symbol'>:overlay_str</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_global_ovl'>global_ovl</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_overlay_options'>overlay_options</span><span class='lbracket'>[</span><span class='symbol'>:overlay_str</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_ovl_reg'>ovl_reg</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_overlay_str'>overlay_str</span>
        <span class='kw'>end</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:no_subr</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_global_ovl'>global_ovl</span>
          <span class='kw'>if</span> <span class='id identifier rubyid_global_ovl'>global_ovl</span>
            <span class='id identifier rubyid_overlay_options'>overlay_options</span><span class='lbracket'>[</span><span class='symbol'>:overlay_style</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='symbol'>:global_label</span>
          <span class='kw'>else</span>
            <span class='id identifier rubyid_overlay_options'>overlay_options</span><span class='lbracket'>[</span><span class='symbol'>:overlay_style</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='symbol'>:label</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_tester_subr_overlay'>tester_subr_overlay</span> <span class='op'>=</span> <span class='op'>!</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:no_subr</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_global_ovl'>global_ovl</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_tester'>tester</span><span class='period'>.</span><span class='id identifier rubyid_overlay_style'>overlay_style</span> <span class='op'>==</span> <span class='symbol'>:subroutine</span>
        <span class='id identifier rubyid_owner'>owner</span><span class='period'>.</span><span class='id identifier rubyid_pin'>pin</span><span class='lparen'>(</span><span class='symbol'>:tdi</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_drive'>drive</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_tester_subr_overlay'>tester_subr_overlay</span>
        <span class='id identifier rubyid_owner'>owner</span><span class='period'>.</span><span class='id identifier rubyid_pin'>pin</span><span class='lparen'>(</span><span class='symbol'>:tdo</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_assert'>assert</span><span class='lparen'>(</span><span class='id identifier rubyid_tdo_reg'>tdo_reg</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:read</span><span class='rbracket'>]</span> <span class='kw'>unless</span> <span class='id identifier rubyid_tester_subr_overlay'>tester_subr_overlay</span>
        <span class='comment'># Force the last bit to be shifted from this method if overlay requested on the last bit
</span>        <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:cycle_last</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>==</span> <span class='id identifier rubyid_size'>size</span> <span class='op'>-</span> <span class='int'>1</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='comment'># Overlay - reconfigure pin action for overlay if necessary
</span>      <span class='kw'>if</span> <span class='id identifier rubyid_ovl_reg'>ovl_reg</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_ovl_reg'>ovl_reg</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_has_overlay?'>has_overlay?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='const'>Origen</span><span class='period'>.</span><span class='id identifier rubyid_mode'>mode</span><span class='period'>.</span><span class='id identifier rubyid_simulation?'>simulation?</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:no_subr</span><span class='rbracket'>]</span>
          <span class='const'>Origen</span><span class='period'>.</span><span class='id identifier rubyid_tester'>tester</span><span class='period'>.</span><span class='id identifier rubyid_dont_compress'>dont_compress</span> <span class='op'>=</span> <span class='kw'>true</span>
          <span class='kw'>if</span> <span class='id identifier rubyid_ovl_reg'>ovl_reg</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_overlay_str'>overlay_str</span> <span class='op'>!=</span> <span class='id identifier rubyid_last_overlay_label'>last_overlay_label</span>
            <span class='gvar'>$tester</span><span class='period'>.</span><span class='id identifier rubyid_label'>label</span><span class='lparen'>(</span><span class='id identifier rubyid_ovl_reg'>ovl_reg</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_overlay_str'>overlay_str</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_last_overlay_label'>last_overlay_label</span> <span class='op'>=</span> <span class='id identifier rubyid_ovl_reg'>ovl_reg</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_overlay_str'>overlay_str</span>
          <span class='kw'>end</span>
          <span class='id identifier rubyid_owner'>owner</span><span class='period'>.</span><span class='id identifier rubyid_pin'>pin</span><span class='lparen'>(</span><span class='symbol'>:tdo</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_assert'>assert</span><span class='lparen'>(</span><span class='id identifier rubyid_tdo_reg'>tdo_reg</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:read</span><span class='rbracket'>]</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_owner'>owner</span><span class='period'>.</span><span class='id identifier rubyid_pin'>pin</span><span class='lparen'>(</span><span class='symbol'>:tdi</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_drive'>drive</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_call_subroutine'>call_subroutine</span> <span class='op'>=</span> <span class='id identifier rubyid_ovl_reg'>ovl_reg</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_overlay_str'>overlay_str</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span> <span class='comment'># of let tester handle overlay
</span>
    <span class='comment'># With JTAG pin actions queued up, use block call to tclk_cycle to
</span>    <span class='comment'>#   execute a single TCLK period.  Special handling of subroutines,
</span>    <span class='comment'>#   case of last bit in shift, and store vector (within a multi-cycle
</span>    <span class='comment'>#   tclk config).
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_call_subroutine'>call_subroutine</span> <span class='op'>||</span> <span class='id identifier rubyid_tester_subr_overlay'>tester_subr_overlay</span>
      <span class='ivar'>@last_data_vector_shifted</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='kw'>else</span>
      <span class='ivar'>@last_data_vector_shifted</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_call_subroutine'>call_subroutine</span>
      <span class='const'>Origen</span><span class='period'>.</span><span class='id identifier rubyid_tester'>tester</span><span class='period'>.</span><span class='id identifier rubyid_call_subroutine'>call_subroutine</span><span class='lparen'>(</span><span class='id identifier rubyid_call_subroutine'>call_subroutine</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='ivar'>@next_data_vector_to_be_stored</span> <span class='op'>=</span> <span class='kw'>false</span>
      <span class='comment'># Don&#39;t latch the last bit, that will be done when leaving the state.
</span>      <span class='kw'>if</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>!=</span> <span class='id identifier rubyid_size'>size</span> <span class='op'>-</span> <span class='int'>1</span> <span class='op'>||</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:cycle_last</span><span class='rbracket'>]</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>==</span> <span class='id identifier rubyid_size'>size</span> <span class='op'>-</span> <span class='int'>1</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:includes_last_bit</span><span class='rbracket'>]</span>
          <span class='kw'>unless</span> <span class='id identifier rubyid_tester_subr_overlay'>tester_subr_overlay</span>
            <span class='id identifier rubyid_owner'>owner</span><span class='period'>.</span><span class='id identifier rubyid_pin'>pin</span><span class='lparen'>(</span><span class='symbol'>:tms</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_drive'>drive</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span>
            <span class='ivar'>@last_data_vector_shifted</span> <span class='op'>=</span> <span class='kw'>true</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_tclk_cycle'>tclk_cycle</span> <span class='kw'>do</span>
          <span class='kw'>if</span> <span class='id identifier rubyid_store_tdo_this_tclk'>store_tdo_this_tclk</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@next_data_vector_to_be_stored</span>
            <span class='const'>Origen</span><span class='period'>.</span><span class='id identifier rubyid_tester'>tester</span><span class='period'>.</span><span class='id identifier rubyid_store_next_cycle'>store_next_cycle</span><span class='lparen'>(</span><span class='id identifier rubyid_owner'>owner</span><span class='period'>.</span><span class='id identifier rubyid_pin'>pin</span><span class='lparen'>(</span><span class='symbol'>:tdo</span><span class='rparen'>)</span><span class='rparen'>)</span>
          <span class='kw'>end</span>
          <span class='kw'>if</span> <span class='id identifier rubyid_overlay_options'>overlay_options</span><span class='lbracket'>[</span><span class='symbol'>:pins</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
            <span class='const'>Origen</span><span class='period'>.</span><span class='id identifier rubyid_tester'>tester</span><span class='period'>.</span><span class='id identifier rubyid_cycle'>cycle</span>
          <span class='kw'>else</span>
            <span class='const'>Origen</span><span class='period'>.</span><span class='id identifier rubyid_tester'>tester</span><span class='period'>.</span><span class='id identifier rubyid_cycle'>cycle</span> <span class='label'>overlay:</span> <span class='id identifier rubyid_overlay_options'>overlay_options</span>
            <span class='id identifier rubyid_overlay_options'>overlay_options</span><span class='lbracket'>[</span><span class='symbol'>:change_data</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>false</span>			<span class='comment'># data change only on first cycle if overlay
</span>          <span class='kw'>end</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_owner'>owner</span><span class='period'>.</span><span class='id identifier rubyid_pin'>pin</span><span class='lparen'>(</span><span class='symbol'>:tdo</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_dont_care'>dont_care</span>
      <span class='kw'>else</span>
        <span class='ivar'>@deferred_compare</span> <span class='op'>=</span> <span class='kw'>true</span>
        <span class='ivar'>@deferred_store</span> <span class='op'>=</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='id identifier rubyid_store_tdo_this_tclk'>store_tdo_this_tclk</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Clear read and similar flags to reflect that the request has just been fulfilled
</span>  <span class='id identifier rubyid_reg_or_val'>reg_or_val</span><span class='period'>.</span><span class='id identifier rubyid_clear_flags'>clear_flags</span> <span class='kw'>if</span> <span class='id identifier rubyid_reg_or_val'>reg_or_val</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:clear_flags</span><span class='rparen'>)</span>

  <span class='comment'># put back compression if turned on above
</span>  <span class='const'>Origen</span><span class='period'>.</span><span class='id identifier rubyid_tester'>tester</span><span class='period'>.</span><span class='id identifier rubyid_dont_compress'>dont_compress</span> <span class='op'>=</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id identifier rubyid_compression_on'>compression_on</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="tclk_cycle-instance_method">
  
    #<strong>tclk_cycle</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Cycles the tester through one TCLK cycle Adjusts for the TCLK format and
cycle span Assumes caller will drive pattern to tester via .drive or
similar</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/origen_jtag/driver.rb', line 256</span>

<span class='kw'>def</span> <span class='id identifier rubyid_tclk_cycle'>tclk_cycle</span>
  <span class='kw'>case</span> <span class='ivar'>@tclk_format</span>
    <span class='kw'>when</span> <span class='symbol'>:rh</span>
      <span class='id identifier rubyid_tclk_val'>tclk_val</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='kw'>when</span> <span class='symbol'>:rl</span>
      <span class='id identifier rubyid_tclk_val'>tclk_val</span> <span class='op'>=</span> <span class='int'>1</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>ERROR: Invalid Tclk timing format!</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>

  <span class='comment'># determine whether to mask TDO on first half cycle
</span>  <span class='id identifier rubyid_mask_tdo_half0'>mask_tdo_half0</span> <span class='op'>=</span>  <span class='lparen'>(</span><span class='lparen'>(</span><span class='ivar'>@tclk_format</span> <span class='op'>==</span> <span class='symbol'>:rl</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='ivar'>@tdo_strobe</span> <span class='op'>==</span> <span class='symbol'>:tclk_low</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='ivar'>@tclk_multiple</span> <span class='op'>&gt;</span> <span class='int'>1</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='op'>||</span>
                    <span class='lparen'>(</span><span class='lparen'>(</span><span class='ivar'>@tclk_format</span> <span class='op'>==</span> <span class='symbol'>:rh</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='ivar'>@tdo_strobe</span> <span class='op'>==</span> <span class='symbol'>:tclk_high</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='ivar'>@tclk_multiple</span> <span class='op'>&gt;</span> <span class='int'>1</span><span class='rparen'>)</span><span class='rparen'>)</span>

  <span class='comment'># determine whether to mask TDO on second half cycle
</span>  <span class='id identifier rubyid_mask_tdo_half1'>mask_tdo_half1</span> <span class='op'>=</span>  <span class='lparen'>(</span><span class='lparen'>(</span><span class='ivar'>@tclk_format</span> <span class='op'>==</span> <span class='symbol'>:rl</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='ivar'>@tdo_strobe</span> <span class='op'>==</span> <span class='symbol'>:tclk_high</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='ivar'>@tclk_multiple</span> <span class='op'>&gt;</span> <span class='int'>1</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='op'>||</span>
                    <span class='lparen'>(</span><span class='lparen'>(</span><span class='ivar'>@tclk_format</span> <span class='op'>==</span> <span class='symbol'>:rh</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='ivar'>@tdo_strobe</span> <span class='op'>==</span> <span class='symbol'>:tclk_low</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='ivar'>@tclk_multiple</span> <span class='op'>&gt;</span> <span class='int'>1</span><span class='rparen'>)</span><span class='rparen'>)</span>

  <span class='comment'># determine whether TDO is set to capture for this TCLK cycle
</span>  <span class='id identifier rubyid_tdo_to_be_captured'>tdo_to_be_captured</span> <span class='op'>=</span> <span class='id identifier rubyid_owner'>owner</span><span class='period'>.</span><span class='id identifier rubyid_pin'>pin</span><span class='lparen'>(</span><span class='symbol'>:tdo</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_be_captured?'>to_be_captured?</span>

  <span class='comment'># If TDO is already suspended (by an application) then don&#39;t do the
</span>  <span class='comment'># suspends below since the resume will clear the application&#39;s suspend
</span>  <span class='id identifier rubyid_tdo_already_suspended'>tdo_already_suspended</span> <span class='op'>=</span> <span class='id identifier rubyid_owner'>owner</span><span class='period'>.</span><span class='id identifier rubyid_pin'>pin</span><span class='lparen'>(</span><span class='symbol'>:tdo</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_suspended?'>suspended?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='ivar'>@tdo_suspended_by_driver</span>

  <span class='ivar'>@tclk_multiple</span><span class='period'>.</span><span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
    <span class='comment'># 50% duty cycle if @tclk_multiple is even, otherwise slightly off
</span>
    <span class='ivar'>@next_data_vector_to_be_stored</span> <span class='op'>=</span> <span class='ivar'>@tdo_store_cycle</span> <span class='op'>==</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>?</span> <span class='kw'>true</span> <span class='op'>:</span> <span class='kw'>false</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>&lt;</span> <span class='lparen'>(</span><span class='ivar'>@tclk_multiple</span> <span class='op'>+</span> <span class='int'>1</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='int'>2</span>
      <span class='comment'># first half of cycle
</span>      <span class='id identifier rubyid_owner'>owner</span><span class='period'>.</span><span class='id identifier rubyid_pin'>pin</span><span class='lparen'>(</span><span class='symbol'>:tclk</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_drive'>drive</span><span class='lparen'>(</span><span class='id identifier rubyid_tclk_val'>tclk_val</span><span class='rparen'>)</span>
      <span class='kw'>unless</span> <span class='id identifier rubyid_tdo_already_suspended'>tdo_already_suspended</span>
        <span class='kw'>unless</span> <span class='id identifier rubyid_tdo_to_be_captured'>tdo_to_be_captured</span>
          <span class='kw'>if</span> <span class='id identifier rubyid_mask_tdo_half0'>mask_tdo_half0</span>
            <span class='ivar'>@tdo_suspended_by_driver</span> <span class='op'>=</span> <span class='kw'>true</span>
            <span class='id identifier rubyid_owner'>owner</span><span class='period'>.</span><span class='id identifier rubyid_pin'>pin</span><span class='lparen'>(</span><span class='symbol'>:tdo</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_suspend'>suspend</span>
          <span class='kw'>else</span>
            <span class='ivar'>@tdo_suspended_by_driver</span> <span class='op'>=</span> <span class='kw'>false</span>
            <span class='id identifier rubyid_owner'>owner</span><span class='period'>.</span><span class='id identifier rubyid_pin'>pin</span><span class='lparen'>(</span><span class='symbol'>:tdo</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_resume'>resume</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='comment'># second half of cycle
</span>      <span class='id identifier rubyid_owner'>owner</span><span class='period'>.</span><span class='id identifier rubyid_pin'>pin</span><span class='lparen'>(</span><span class='symbol'>:tclk</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_drive'>drive</span><span class='lparen'>(</span><span class='int'>1</span> <span class='op'>-</span> <span class='id identifier rubyid_tclk_val'>tclk_val</span><span class='rparen'>)</span>
      <span class='kw'>unless</span> <span class='id identifier rubyid_tdo_already_suspended'>tdo_already_suspended</span>
        <span class='kw'>unless</span> <span class='id identifier rubyid_tdo_to_be_captured'>tdo_to_be_captured</span>
          <span class='kw'>if</span> <span class='id identifier rubyid_mask_tdo_half1'>mask_tdo_half1</span>
            <span class='ivar'>@tdo_suspended_by_driver</span> <span class='op'>=</span> <span class='kw'>true</span>
            <span class='id identifier rubyid_owner'>owner</span><span class='period'>.</span><span class='id identifier rubyid_pin'>pin</span><span class='lparen'>(</span><span class='symbol'>:tdo</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_suspend'>suspend</span>
          <span class='kw'>else</span>
            <span class='ivar'>@tdo_suspended_by_driver</span> <span class='op'>=</span> <span class='kw'>false</span>
            <span class='id identifier rubyid_owner'>owner</span><span class='period'>.</span><span class='id identifier rubyid_pin'>pin</span><span class='lparen'>(</span><span class='symbol'>:tdo</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_resume'>resume</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='kw'>yield</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='ivar'>@tdo_suspended_by_driver</span>
    <span class='id identifier rubyid_owner'>owner</span><span class='period'>.</span><span class='id identifier rubyid_pin'>pin</span><span class='lparen'>(</span><span class='symbol'>:tdo</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_resume'>resume</span>
    <span class='ivar'>@tdo_suspended_by_driver</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="tms!-instance_method">
  
    #<strong>tms!</strong>(val)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Applies the given value to the TMS pin and then cycles the tester for one
TCLK</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>val</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Value to drive on the TMS pin, 0 or 1</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/origen_jtag/driver.rb', line 327</span>

<span class='kw'>def</span> <span class='id identifier rubyid_tms!'>tms!</span><span class='lparen'>(</span><span class='id identifier rubyid_val'>val</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='ivar'>@deferred_compare</span>
    <span class='ivar'>@deferred_compare</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_owner'>owner</span><span class='period'>.</span><span class='id identifier rubyid_pin'>pin</span><span class='lparen'>(</span><span class='symbol'>:tdo</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_dont_care'>dont_care</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='ivar'>@deferred_store</span>
    <span class='ivar'>@deferred_store</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_store_tdo_this_tclk'>store_tdo_this_tclk</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_store_tdo_this_tclk'>store_tdo_this_tclk</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='kw'>end</span>
  <span class='ivar'>@next_data_vector_to_be_stored</span> <span class='op'>=</span> <span class='kw'>false</span>

  <span class='id identifier rubyid_tclk_cycle'>tclk_cycle</span> <span class='kw'>do</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_store_tdo_this_tclk'>store_tdo_this_tclk</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@next_data_vector_to_be_stored</span>
      <span class='const'>Origen</span><span class='period'>.</span><span class='id identifier rubyid_tester'>tester</span><span class='period'>.</span><span class='id identifier rubyid_store_next_cycle'>store_next_cycle</span><span class='lparen'>(</span><span class='id identifier rubyid_owner'>owner</span><span class='period'>.</span><span class='id identifier rubyid_pin'>pin</span><span class='lparen'>(</span><span class='symbol'>:tdo</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_owner'>owner</span><span class='period'>.</span><span class='id identifier rubyid_pin'>pin</span><span class='lparen'>(</span><span class='symbol'>:tms</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_drive!'>drive!</span><span class='lparen'>(</span><span class='id identifier rubyid_val'>val</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="write_dr-instance_method">
  
    #<strong>write_dr</strong>(reg_or_val, options = {})  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Write the given value, register or bit collection to the data register.
This is a self contained method that will take care of the TAP controller
state transitions, exiting with the TAP controller in Run-Test/Idle.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>reg_or_val</span>
      
      
        <span class='type'>(<tt>Integer</tt>, <tt>Origen::Register::Reg</tt>, <tt>Origen::Register::BitCollection</tt>, <tt>Origen::Register::Bit</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Value to be written. If a reg/bit collection is supplied this can be
pre-marked for overlay.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Options to customize the operation</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:size</span>
          <span class="type">(<tt>Integer</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The number of bits to write. This is optional when supplying a register or
bit collection in which case the size will be derived from the number of
bits supplied. If this option is supplied then it will override the size
derived from the bits. If the size is greater than the number of bits
provided then the additional space will be padded by 0s.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:msg</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>By default will not make any comments directly here.  Can pass a msg to be
written out prior to shifting data.</p>
</div>
          
        </li>
      
    </ul>
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


364
365
366
367
368
369
370
371
372
373
374
375
376</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/origen_jtag/driver.rb', line 364</span>

<span class='kw'>def</span> <span class='id identifier rubyid_write_dr'>write_dr</span><span class='lparen'>(</span><span class='id identifier rubyid_reg_or_val'>reg_or_val</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='const'>Origen</span><span class='period'>.</span><span class='id identifier rubyid_tester'>tester</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:write_dr</span><span class='rparen'>)</span>
    <span class='const'>Origen</span><span class='period'>.</span><span class='id identifier rubyid_tester'>tester</span><span class='period'>.</span><span class='id identifier rubyid_write_dr'>write_dr</span><span class='lparen'>(</span><span class='id identifier rubyid_reg_or_val'>reg_or_val</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:msg</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_cc'>cc</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:msg</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_val'>val</span> <span class='op'>=</span> <span class='id identifier rubyid_reg_or_val'>reg_or_val</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:data</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='id identifier rubyid_reg_or_val'>reg_or_val</span><span class='period'>.</span><span class='id identifier rubyid_data'>data</span> <span class='op'>:</span> <span class='id identifier rubyid_reg_or_val'>reg_or_val</span>
    <span class='id identifier rubyid_shift_dr'>shift_dr</span><span class='lparen'>(</span><span class='label'>write:</span> <span class='id identifier rubyid_val'>val</span><span class='period'>.</span><span class='id identifier rubyid_to_hex'>to_hex</span><span class='rparen'>)</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_shift'>shift</span><span class='lparen'>(</span><span class='id identifier rubyid_reg_or_val'>reg_or_val</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="write_ir-instance_method">
  
    #<strong>write_ir</strong>(reg_or_val, options = {})  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Write the given value, register or bit collection to the instruction
register. This is a self contained method that will take care of the TAP
controller state transitions, exiting with the TAP controller in
Run-Test/Idle.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>reg_or_val</span>
      
      
        <span class='type'>(<tt>Integer</tt>, <tt>Origen::Register::Reg</tt>, <tt>Origen::Register::BitCollection</tt>, <tt>Origen::Register::Bit</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Value to be written. If a reg/bit collection is supplied this can be
pre-marked for overlay.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Options to customize the operation</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:size</span>
          <span class="type">(<tt>Integer</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The number of bits to write. This is optional when supplying a register or
bit collection in which case the size will be derived from the number of
bits supplied. If this option is supplied then it will override the size
derived from the bits. If the size is greater than the number of bits
provided then the additional space will be padded by 0s.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:force</span>
          <span class="type">(<tt>Boolean</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>By default multiple calls to this method will not generate multiple writes.
This is to allow wrapper algorithms to remain efficient yet not have to
manually track the IR state (and in many cases this may be impossible due
to multiple protocols using the same JTAG). To force a write regardless of
what the driver thinks the IR contains set this to true.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:msg</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>By default will not make any comments directly here.  Can pass a msg to be
written out prior to shifting in IR data.  Will not write comment only if
write occurs.</p>
</div>
          
        </li>
      
    </ul>
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/origen_jtag/driver.rb', line 431</span>

<span class='kw'>def</span> <span class='id identifier rubyid_write_ir'>write_ir</span><span class='lparen'>(</span><span class='id identifier rubyid_reg_or_val'>reg_or_val</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='const'>Origen</span><span class='period'>.</span><span class='id identifier rubyid_tester'>tester</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:write_ir</span><span class='rparen'>)</span>
    <span class='const'>Origen</span><span class='period'>.</span><span class='id identifier rubyid_tester'>tester</span><span class='period'>.</span><span class='id identifier rubyid_write_ir'>write_ir</span><span class='lparen'>(</span><span class='id identifier rubyid_reg_or_val'>reg_or_val</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_val'>val</span> <span class='op'>=</span> <span class='id identifier rubyid_reg_or_val'>reg_or_val</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:data</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='id identifier rubyid_reg_or_val'>reg_or_val</span><span class='period'>.</span><span class='id identifier rubyid_data'>data</span> <span class='op'>:</span> <span class='id identifier rubyid_reg_or_val'>reg_or_val</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_val'>val</span> <span class='op'>!=</span> <span class='id identifier rubyid_ir_value'>ir_value</span> <span class='op'>||</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:force</span><span class='rbracket'>]</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:msg</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_cc'>cc</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:msg</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_shift_ir'>shift_ir</span><span class='lparen'>(</span><span class='label'>write:</span> <span class='id identifier rubyid_val'>val</span><span class='period'>.</span><span class='id identifier rubyid_to_hex'>to_hex</span><span class='rparen'>)</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_shift'>shift</span><span class='lparen'>(</span><span class='id identifier rubyid_reg_or_val'>reg_or_val</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='ivar'>@ir_value</span> <span class='op'>=</span> <span class='id identifier rubyid_val'>val</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Wed Mar 14 07:34:16 2018 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.9 (ruby-2.3.0).
</div>

    </div>
  </body>
</html>