<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: CrossOrigen::IpXact
  
    &mdash; Cross Origen 1.2.0
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "CrossOrigen::IpXact";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (I)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../CrossOrigen.html" title="CrossOrigen (module)">CrossOrigen</a></span></span>
     &raquo; 
    <span class="title">IpXact</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: CrossOrigen::IpXact
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName"><span class='object_link'><a href="XMLDoc.html" title="CrossOrigen::XMLDoc (class)">XMLDoc</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next"><span class='object_link'><a href="XMLDoc.html" title="CrossOrigen::XMLDoc (class)">XMLDoc</a></span></li>
          
            <li class="next">CrossOrigen::IpXact</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/cross_origen/ip_xact.rb</dd>
  </dl>
  
</div>

<h2>Defined Under Namespace</h2>
<p class="children">
  
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="IpXact/AddressBlock.html" title="CrossOrigen::IpXact::AddressBlock (class)">AddressBlock</a></span>, <span class='object_link'><a href="IpXact/AddressSpace.html" title="CrossOrigen::IpXact::AddressSpace (class)">AddressSpace</a></span>, <span class='object_link'><a href="IpXact/MemoryMaps.html" title="CrossOrigen::IpXact::MemoryMaps (class)">MemoryMaps</a></span>
    
  
</p>

  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="access_hash-classvariable" class="">@@access_hash =
          <div class="docstring">
  <div class="discussion">
    
<p>Create a shorthand way to reference Origen Core&#39;s Bit ACCESS_CODES</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='const'>Origen</span><span class='op'>::</span><span class='const'>Registers</span><span class='op'>::</span><span class='const'>Bit</span><span class='period'>.</span><span class='id identifier rubyid_const_get'>const_get</span><span class='lparen'>(</span><span class='symbol'>:ACCESS_CODES</span><span class='rparen'>)</span></pre></dd>
      
    </dl>
  



  
  
  <h3 class="inherited">Constants inherited
     from <span class='object_link'><a href="XMLDoc.html" title="CrossOrigen::XMLDoc (class)">XMLDoc</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="XMLDoc.html#HTML_SANITIZATION_CONFIG-constant" title="CrossOrigen::XMLDoc::HTML_SANITIZATION_CONFIG (constant)">XMLDoc::HTML_SANITIZATION_CONFIG</a></span>, <span class='object_link'><a href="XMLDoc.html#HTML_TRANSFORMER-constant" title="CrossOrigen::XMLDoc::HTML_TRANSFORMER (constant)">XMLDoc::HTML_TRANSFORMER</a></span>, <span class='object_link'><a href="XMLDoc.html#HTML_TRANSFORMS-constant" title="CrossOrigen::XMLDoc::HTML_TRANSFORMS (constant)">XMLDoc::HTML_TRANSFORMS</a></span></p>




  <h2>Instance Attribute Summary</h2>
  
  <h3 class="inherited">Attributes inherited from <span class='object_link'><a href="XMLDoc.html" title="CrossOrigen::XMLDoc (class)">XMLDoc</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="XMLDoc.html#creation_info-instance_method" title="CrossOrigen::XMLDoc#creation_info (method)">#creation_info</a></span>, <span class='object_link'><a href="XMLDoc.html#import_info-instance_method" title="CrossOrigen::XMLDoc#import_info (method)">#import_info</a></span>, <span class='object_link'><a href="XMLDoc.html#owner-instance_method" title="CrossOrigen::XMLDoc#owner (method)">#owner</a></span></p>


  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#doc-instance_method" title="#doc (instance method)">#<strong>doc</strong>(path, options = {})  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#import-instance_method" title="#import (instance method)">#<strong>import</strong>(file, options = {})  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Import/reader that currently only supports creating registers and bit
fields.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#owner_to_xml-instance_method" title="#owner_to_xml (instance method)">#<strong>owner_to_xml</strong>(options = {})  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns a string representing the owner object in IP-XACT XML Usable /
Available options:   :vendor             = Company name/web address, ex:
&#39;nxp.com&#39;   :library            = IP Library   :schema            
= &#39;1685-2009&#39; or default of Spirit 1.4 (when no :schema option
passed)   :bus_interface      = only &#39;AMBA3&#39; supported at this time
:mmap_name          = Optionally set the memoryMap name to something other
than the module name   :mmap_ref           = memoryMapRef name, ex:
&#39;UserMap&#39;.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="XMLDoc.html" title="CrossOrigen::XMLDoc (class)">XMLDoc</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="XMLDoc.html#extract-instance_method" title="CrossOrigen::XMLDoc#extract (method)">#extract</a></span>, <span class='object_link'><a href="XMLDoc.html#fetch-instance_method" title="CrossOrigen::XMLDoc#fetch (method)">#fetch</a></span>, <span class='object_link'><a href="XMLDoc.html#initialize-instance_method" title="CrossOrigen::XMLDoc#initialize (method)">#initialize</a></span>, <span class='object_link'><a href="XMLDoc.html#pre_sanitize-instance_method" title="CrossOrigen::XMLDoc#pre_sanitize (method)">#pre_sanitize</a></span>, <span class='object_link'><a href="XMLDoc.html#to_html-instance_method" title="CrossOrigen::XMLDoc#to_html (method)">#to_html</a></span>, <span class='object_link'><a href="XMLDoc.html#to_markdown-instance_method" title="CrossOrigen::XMLDoc#to_markdown (method)">#to_markdown</a></span>, <span class='object_link'><a href="XMLDoc.html#try-instance_method" title="CrossOrigen::XMLDoc#try (method)">#try</a></span></p>
<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <p class="notice">This class inherits a constructor from <span class='object_link'><a href="XMLDoc.html#initialize-instance_method" title="CrossOrigen::XMLDoc#initialize (method)">CrossOrigen::XMLDoc</a></span></p>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="doc-instance_method">
  
    #<strong>doc</strong>(path, options = {})  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cross_origen/ip_xact.rb', line 129</span>

<span class='kw'>def</span> <span class='id identifier rubyid_doc'>doc</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='comment'># If a fragment of IP-XACT is given, then wrap it with a valid header and we will try our best
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:fragment</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>nokogiri</span><span class='tstring_end'>&#39;</span></span>

    <span class='id identifier rubyid_content'>content</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>%(</span><span class='tstring_content'>
&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;spirit:component xmlns:spirit=&quot;https://www.spiritconsortium.org/XMLSchema/SPIRIT/1.4&quot;
xmlns:xsi=&quot;https://www.w3.org/2001/XMLSchema-instance&quot;
xsi:schemaLocation=&quot;$REGMEM_HOME/builder/ipxact/schema/ipxact
      $REGMEM_HOME/builder/ipxact/schema/ipxact/index.xsd&quot;&gt;
    </span><span class='embexpr_beg'>#{</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>
&lt;/spirit:component&gt;
    </span><span class='tstring_end'>)</span></span>
    <span class='kw'>yield</span> <span class='const'>Nokogiri</span><span class='op'>::</span><span class='const'>XML</span><span class='lparen'>(</span><span class='id identifier rubyid_content'>content</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='kw'>super</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="import-instance_method">
  
    #<strong>import</strong>(file, options = {})  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Import/reader that currently only supports creating registers and bit
fields</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cross_origen/ip_xact.rb', line 13</span>

<span class='kw'>def</span> <span class='id identifier rubyid_import'>import</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span> <span class='comment'># rubocop:disable CyclomaticComplexity
</span>  <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>kramdown</span><span class='tstring_end'>&#39;</span></span>

  <span class='id identifier rubyid_filename'>filename</span> <span class='op'>=</span> <span class='const'>Pathname</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_basename'>basename</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.*</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>

  <span class='kw'>unless</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:refresh</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='const'><span class='object_link'><a href="../CrossOrigen.html" title="CrossOrigen (module)">CrossOrigen</a></span></span><span class='period'>.</span><span class='id identifier rubyid_refresh?'><span class='object_link'><a href="../CrossOrigen.html#refresh%3F-class_method" title="CrossOrigen.refresh? (method)">refresh?</a></span></span>
    <span class='kw'>return</span> <span class='kw'>if</span> <span class='id identifier rubyid_owner'>owner</span><span class='period'>.</span><span class='id identifier rubyid_import'>import</span><span class='lparen'>(</span><span class='id identifier rubyid_filename'>filename</span><span class='comma'>,</span> <span class='label'>allow_missing:</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_model'>model</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../CrossOrigen.html" title="CrossOrigen (module)">CrossOrigen</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Model.html" title="CrossOrigen::Model (class)">Model</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>

  <span class='id identifier rubyid_address_spaces'>address_spaces</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>

  <span class='id identifier rubyid_doc'>doc</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_doc'>doc</span><span class='op'>|</span>
    <span class='id identifier rubyid_doc'>doc</span><span class='period'>.</span><span class='id identifier rubyid_xpath'>xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>//spirit:addressSpaces/spirit:addressSpace</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_addr_space'>addr_space</span><span class='op'>|</span>
      <span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='id identifier rubyid_fetch'>fetch</span> <span class='id identifier rubyid_addr_space'>addr_space</span><span class='period'>.</span><span class='id identifier rubyid_at_xpath'>at_xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>spirit:name</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='label'>downcase:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>to_sym:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>get_text:</span> <span class='kw'>true</span>
      <span class='id identifier rubyid_range'>range</span> <span class='op'>=</span> <span class='id identifier rubyid_fetch'>fetch</span> <span class='id identifier rubyid_addr_space'>addr_space</span><span class='period'>.</span><span class='id identifier rubyid_at_xpath'>at_xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>spirit:range</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='label'>get_text:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>to_dec:</span> <span class='kw'>true</span>
      <span class='id identifier rubyid_width'>width</span> <span class='op'>=</span> <span class='id identifier rubyid_fetch'>fetch</span> <span class='id identifier rubyid_addr_space'>addr_space</span><span class='period'>.</span><span class='id identifier rubyid_at_xpath'>at_xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>spirit:width</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='label'>get_text:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>to_i:</span> <span class='kw'>true</span>
      <span class='id identifier rubyid_address_spaces'>address_spaces</span><span class='lbracket'>[</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="IpXact/AddressSpace.html" title="CrossOrigen::IpXact::AddressSpace (class)">AddressSpace</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="XMLDoc.html#initialize-instance_method" title="CrossOrigen::XMLDoc#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_range'>range</span><span class='comma'>,</span> <span class='id identifier rubyid_width'>width</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_open_memory_map'>open_memory_map</span><span class='lparen'>(</span><span class='id identifier rubyid_doc'>doc</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_mem_map'>mem_map</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_mem_map'>mem_map</span>
        <span class='id identifier rubyid_mem_map_name'>mem_map_name</span> <span class='op'>=</span> <span class='id identifier rubyid_fetch'>fetch</span> <span class='id identifier rubyid_mem_map'>mem_map</span><span class='period'>.</span><span class='id identifier rubyid_at_xpath'>at_xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>spirit:name</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='label'>downcase:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>to_sym:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>get_text:</span> <span class='kw'>true</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_mem_map_name'>mem_map_name</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
          <span class='id identifier rubyid_mem_map_obj'>mem_map_obj</span> <span class='op'>=</span> <span class='id identifier rubyid_model'>model</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_model'>model</span><span class='period'>.</span><span class='id identifier rubyid_sub_block'>sub_block</span> <span class='id identifier rubyid_mem_map_name'>mem_map_name</span>
          <span class='id identifier rubyid_mem_map_obj'>mem_map_obj</span> <span class='op'>=</span> <span class='id identifier rubyid_model'>model</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='id identifier rubyid_mem_map_name'>mem_map_name</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_addr_blocks'>addr_blocks</span> <span class='op'>=</span> <span class='id identifier rubyid_mem_map'>mem_map</span><span class='period'>.</span><span class='id identifier rubyid_xpath'>xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>spirit:addressBlock</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_mem_map_obj'>mem_map_obj</span> <span class='op'>=</span> <span class='id identifier rubyid_model'>model</span>
        <span class='id identifier rubyid_addr_blocks'>addr_blocks</span> <span class='op'>=</span> <span class='id identifier rubyid_doc'>doc</span><span class='period'>.</span><span class='id identifier rubyid_xpath'>xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>//spirit:addressBlock</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_addr_blocks'>addr_blocks</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_addr_block'>addr_block</span><span class='op'>|</span>
        <span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='id identifier rubyid_fetch'>fetch</span> <span class='id identifier rubyid_addr_block'>addr_block</span><span class='period'>.</span><span class='id identifier rubyid_at_xpath'>at_xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>spirit:name</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='label'>downcase:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>to_sym:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>get_text:</span> <span class='kw'>true</span>
        <span class='id identifier rubyid_base_address'>base_address</span> <span class='op'>=</span> <span class='id identifier rubyid_fetch'>fetch</span> <span class='id identifier rubyid_addr_block'>addr_block</span><span class='period'>.</span><span class='id identifier rubyid_at_xpath'>at_xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>spirit:baseAddress</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='label'>get_text:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>to_dec:</span> <span class='kw'>true</span>
        <span class='id identifier rubyid_range'>range</span> <span class='op'>=</span> <span class='id identifier rubyid_fetch'>fetch</span> <span class='id identifier rubyid_addr_block'>addr_block</span><span class='period'>.</span><span class='id identifier rubyid_at_xpath'>at_xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>spirit:range</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='label'>get_text:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>to_dec:</span> <span class='kw'>true</span>
        <span class='id identifier rubyid_width'>width</span> <span class='op'>=</span> <span class='id identifier rubyid_fetch'>fetch</span> <span class='id identifier rubyid_addr_block'>addr_block</span><span class='period'>.</span><span class='id identifier rubyid_at_xpath'>at_xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>spirit:width</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='label'>get_text:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>to_i:</span> <span class='kw'>true</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
          <span class='id identifier rubyid_addr_block_obj'>addr_block_obj</span> <span class='op'>=</span> <span class='id identifier rubyid_mem_map_obj'>mem_map_obj</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_mem_map_obj'>mem_map_obj</span><span class='period'>.</span><span class='id identifier rubyid_sub_block'>sub_block</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='label'>base_address:</span> <span class='id identifier rubyid_base_address'>base_address</span><span class='comma'>,</span> <span class='label'>range:</span> <span class='id identifier rubyid_range'>range</span><span class='comma'>,</span> <span class='label'>lau:</span> <span class='id identifier rubyid_width'>width</span>
          <span class='id identifier rubyid_addr_block_obj'>addr_block_obj</span> <span class='op'>=</span> <span class='id identifier rubyid_mem_map_obj'>mem_map_obj</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_addr_block'>addr_block</span><span class='period'>.</span><span class='id identifier rubyid_xpath'>xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>spirit:register</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_register'>register</span><span class='op'>|</span>
          <span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='id identifier rubyid_fetch'>fetch</span> <span class='id identifier rubyid_register'>register</span><span class='period'>.</span><span class='id identifier rubyid_at_xpath'>at_xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>spirit:name</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='label'>downcase:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>to_sym:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>get_text:</span> <span class='kw'>true</span>
          <span class='id identifier rubyid_size'>size</span> <span class='op'>=</span> <span class='id identifier rubyid_fetch'>fetch</span> <span class='id identifier rubyid_register'>register</span><span class='period'>.</span><span class='id identifier rubyid_at_xpath'>at_xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>spirit:size</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='label'>get_text:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>to_i:</span> <span class='kw'>true</span>
          <span class='id identifier rubyid_addr_offset'>addr_offset</span> <span class='op'>=</span> <span class='id identifier rubyid_fetch'>fetch</span> <span class='id identifier rubyid_register'>register</span><span class='period'>.</span><span class='id identifier rubyid_at_xpath'>at_xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>spirit:addressOffset</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='label'>get_text:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>to_dec:</span> <span class='kw'>true</span>
          <span class='id identifier rubyid_access'>access</span> <span class='op'>=</span> <span class='id identifier rubyid_fetch'>fetch</span> <span class='id identifier rubyid_register'>register</span><span class='period'>.</span><span class='id identifier rubyid_at_xpath'>at_xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>spirit:access</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='label'>get_text:</span> <span class='kw'>true</span>
          <span class='id identifier rubyid_reset_value'>reset_value</span> <span class='op'>=</span> <span class='id identifier rubyid_fetch'>fetch</span> <span class='id identifier rubyid_register'>register</span><span class='period'>.</span><span class='id identifier rubyid_at_xpath'>at_xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>spirit:reset/spirit:value</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='label'>get_text:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>to_dec:</span> <span class='kw'>true</span>
          <span class='id identifier rubyid_reset_mask'>reset_mask</span> <span class='op'>=</span> <span class='id identifier rubyid_fetch'>fetch</span> <span class='id identifier rubyid_register'>register</span><span class='period'>.</span><span class='id identifier rubyid_at_xpath'>at_xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>spirit:reset/spirit:mask</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='label'>get_text:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>to_dec:</span> <span class='kw'>true</span>
          <span class='kw'>if</span> <span class='lbracket'>[</span><span class='id identifier rubyid_reset_value'>reset_value</span><span class='comma'>,</span> <span class='id identifier rubyid_reset_mask'>reset_mask</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='kw'>nil</span>
            <span class='comment'># Set default values for some register attributes
</span>            <span class='id identifier rubyid_reset_value'>reset_value</span><span class='comma'>,</span> <span class='id identifier rubyid_reset_mask'>reset_mask</span> <span class='op'>=</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span>
          <span class='kw'>else</span>
            <span class='comment'># Do a logical bitwise AND with the reset value and mask
</span>            <span class='id identifier rubyid_reset_value'>reset_value</span> <span class='op'>=</span> <span class='id identifier rubyid_reset_value'>reset_value</span> <span class='op'>&amp;</span> <span class='id identifier rubyid_reset_mask'>reset_mask</span>
          <span class='kw'>end</span>
          <span class='comment'># Future expansion: pull in HDL path as abs_path in Origen.
</span>          <span class='id identifier rubyid_addr_block_obj'>addr_block_obj</span><span class='period'>.</span><span class='id identifier rubyid_reg'>reg</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_addr_offset'>addr_offset</span><span class='comma'>,</span> <span class='label'>size:</span> <span class='id identifier rubyid_size'>size</span><span class='comma'>,</span> <span class='label'>access:</span> <span class='id identifier rubyid_access'>access</span><span class='comma'>,</span> <span class='label'>description:</span> <span class='id identifier rubyid_reg_description'>reg_description</span><span class='lparen'>(</span><span class='id identifier rubyid_register'>register</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_reg'>reg</span><span class='op'>|</span>
            <span class='id identifier rubyid_register'>register</span><span class='period'>.</span><span class='id identifier rubyid_xpath'>xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>spirit:field</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_field'>field</span><span class='op'>|</span>
              <span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='id identifier rubyid_fetch'>fetch</span> <span class='id identifier rubyid_field'>field</span><span class='period'>.</span><span class='id identifier rubyid_at_xpath'>at_xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>spirit:name</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='label'>downcase:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>to_sym:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>get_text:</span> <span class='kw'>true</span>
              <span class='id identifier rubyid_bit_offset'>bit_offset</span> <span class='op'>=</span> <span class='id identifier rubyid_fetch'>fetch</span> <span class='id identifier rubyid_field'>field</span><span class='period'>.</span><span class='id identifier rubyid_at_xpath'>at_xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>spirit:bitOffset</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='label'>get_text:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>to_i:</span> <span class='kw'>true</span>
              <span class='id identifier rubyid_bit_width'>bit_width</span> <span class='op'>=</span> <span class='id identifier rubyid_fetch'>fetch</span> <span class='id identifier rubyid_field'>field</span><span class='period'>.</span><span class='id identifier rubyid_at_xpath'>at_xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>spirit:bitWidth</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='label'>get_text:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>to_i:</span> <span class='kw'>true</span>
              <span class='id identifier rubyid_xml_access'>xml_access</span> <span class='op'>=</span> <span class='id identifier rubyid_fetch'>fetch</span> <span class='id identifier rubyid_field'>field</span><span class='period'>.</span><span class='id identifier rubyid_at_xpath'>at_xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>spirit:access</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='label'>get_text:</span> <span class='kw'>true</span>
              <span class='comment'># Newer IP-XACT standards list access as &lt; read or write&gt;-&lt; descriptor &gt;, such as
</span>              <span class='comment'># &quot;read-write&quot;, &quot;read-only&quot;, or &quot;read-writeOnce&quot;
</span>              <span class='kw'>if</span> <span class='id identifier rubyid_xml_access'>xml_access</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\S+\-\S+</span><span class='regexp_end'>/</span></span> <span class='op'>||</span> <span class='id identifier rubyid_xml_access'>xml_access</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>writeOnce</span><span class='tstring_end'>&#39;</span></span>
                <span class='comment'># This filter alone is not capable of interpreting the 1685-2009 (and 2014).  Therefore
</span>                <span class='comment'># must reverse-interpret the content of access_hash (see top of file).
</span>                <span class='comment'>#
</span>                <span class='comment'># First get the base access type, ie: read-write, read-only, etc.
</span>                <span class='comment'># base_access = fetch field.at_xpath(&#39;spirit:access&#39;), get_text: true
</span>                <span class='id identifier rubyid_base_access'>base_access</span> <span class='op'>=</span> <span class='id identifier rubyid_xml_access'>xml_access</span>
                <span class='comment'># Next grab any modified write values or read actions
</span>                <span class='id identifier rubyid_mod_write'>mod_write</span> <span class='op'>=</span> <span class='id identifier rubyid_fetch'>fetch</span> <span class='id identifier rubyid_field'>field</span><span class='period'>.</span><span class='id identifier rubyid_at_xpath'>at_xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>spirit:modifiedWriteValue</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='label'>get_text:</span> <span class='kw'>true</span>
                <span class='id identifier rubyid_read_action'>read_action</span> <span class='op'>=</span> <span class='id identifier rubyid_fetch'>fetch</span> <span class='id identifier rubyid_field'>field</span><span class='period'>.</span><span class='id identifier rubyid_at_xpath'>at_xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>spirit:readAction</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='label'>get_text:</span> <span class='kw'>true</span>
                <span class='comment'># Using base_access, mod_write, and read_action, look up the corresponding access
</span>                <span class='comment'># acronym from access_hash, noting it is not possible to differentiate write-only
</span>                <span class='comment'># from write-only, read zero and read-write from dc.
</span>                <span class='comment'>#
</span>                <span class='comment'># Matched needs to be tracked, as there is no way to differentiate :rw and :dc in IP-XACT.
</span>                <span class='comment'># Everything imported will default to :rw, never :dc.
</span>                <span class='id identifier rubyid_matched'>matched</span> <span class='op'>=</span> <span class='kw'>false</span>
                <span class='cvar'>@@access_hash</span><span class='period'>.</span><span class='id identifier rubyid_each_key'>each_key</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='op'>|</span>
                  <span class='kw'>if</span> <span class='cvar'>@@access_hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:base</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='id identifier rubyid_base_access'>base_access</span> <span class='op'>&amp;&amp;</span> <span class='cvar'>@@access_hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:write</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='id identifier rubyid_mod_write'>mod_write</span> <span class='op'>&amp;&amp;</span> <span class='cvar'>@@access_hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:read</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='id identifier rubyid_read_action'>read_action</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_matched'>matched</span>
                    <span class='id identifier rubyid_access'>access</span> <span class='op'>=</span> <span class='id identifier rubyid_key'>key</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
                    <span class='id identifier rubyid_matched'>matched</span> <span class='op'>=</span> <span class='kw'>true</span>
                  <span class='kw'>end</span>
                <span class='kw'>end</span>
              <span class='comment'># Older IP-XACT standards appear to also accept short acronyms like &quot;ro&quot;, &quot;w1c&quot;, &quot;rw&quot;,
</span>              <span class='comment'># etc.
</span>              <span class='kw'>elsif</span> <span class='id identifier rubyid_xml_access'>xml_access</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\S+</span><span class='regexp_end'>/</span></span>
                <span class='id identifier rubyid_access'>access</span> <span class='op'>=</span> <span class='id identifier rubyid_xml_access'>xml_access</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
              <span class='kw'>else</span>
                <span class='comment'># default to read-write if access is not specified
</span>                <span class='id identifier rubyid_access'>access</span> <span class='op'>=</span> <span class='symbol'>:rw</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_range'>range</span> <span class='op'>=</span> <span class='kw'>nil</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_bit_width'>bit_width</span> <span class='op'>==</span> <span class='int'>1</span>
                <span class='id identifier rubyid_range'>range</span> <span class='op'>=</span> <span class='id identifier rubyid_bit_offset'>bit_offset</span>
              <span class='kw'>else</span>
                <span class='id identifier rubyid_range'>range</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_bit_offset'>bit_offset</span> <span class='op'>+</span> <span class='id identifier rubyid_bit_width'>bit_width</span> <span class='op'>-</span> <span class='int'>1</span><span class='rparen'>)</span><span class='op'>..</span><span class='id identifier rubyid_bit_offset'>bit_offset</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_reg'>reg</span><span class='period'>.</span><span class='id identifier rubyid_bit'>bit</span> <span class='id identifier rubyid_range'>range</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='label'>reset:</span> <span class='id identifier rubyid_reset_value'>reset_value</span><span class='lbracket'>[</span><span class='id identifier rubyid_range'>range</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>access:</span> <span class='id identifier rubyid_access'>access</span><span class='comma'>,</span> <span class='label'>description:</span> <span class='id identifier rubyid_bit_description'>bit_description</span><span class='lparen'>(</span><span class='id identifier rubyid_field'>field</span><span class='rparen'>)</span>
            <span class='kw'>end</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_model'>model</span><span class='period'>.</span><span class='id identifier rubyid_export'>export</span><span class='lparen'>(</span><span class='id identifier rubyid_filename'>filename</span><span class='comma'>,</span> <span class='label'>include_timestamp:</span> <span class='const'><span class='object_link'><a href="../CrossOrigen.html" title="CrossOrigen (module)">CrossOrigen</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include_timestamp?'><span class='object_link'><a href="../CrossOrigen.html#include_timestamp%3F-class_method" title="CrossOrigen.include_timestamp? (method)">include_timestamp?</a></span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_owner'>owner</span><span class='period'>.</span><span class='id identifier rubyid_import'>import</span><span class='lparen'>(</span><span class='id identifier rubyid_filename'>filename</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="owner_to_xml-instance_method">
  
    #<strong>owner_to_xml</strong>(options = {})  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a string representing the owner object in IP-XACT XML Usable /
Available options:</p>

<pre class="code ruby"><code class="ruby">:vendor             = Company name/web address, ex: &#39;nxp.com&#39;
:library            = IP Library
:schema             = &#39;1685-2009&#39; or default of Spirit 1.4 (when no :schema option passed)
:bus_interface      = only &#39;AMBA3&#39; supported at this time
:mmap_name          = Optionally set the memoryMap name to something other than the module name
:mmap_ref           = memoryMapRef name, ex: &#39;UserMap&#39;
</code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cross_origen/ip_xact.rb', line 157</span>

<span class='kw'>def</span> <span class='id identifier rubyid_owner_to_xml'>owner_to_xml</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>nokogiri</span><span class='tstring_end'>&#39;</span></span>

  <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span>
    <span class='label'>include_bit_field_values:</span> <span class='kw'>true</span>
  <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>

  <span class='ivar'>@format</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:format</span><span class='rbracket'>]</span>

  <span class='comment'># Compatible schemas: Spirit 1.4, 1685-2009
</span>  <span class='comment'># Assume Spirit 1.4 if no schema provided
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:schema</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>1685-2009</span><span class='tstring_end'>&#39;</span></span> <span class='comment'># Magillem tool uses alternate schema
</span>    <span class='id identifier rubyid_schemas'>schemas</span> <span class='op'>=</span> <span class='lbracket'>[</span>
      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>https://www.spiritconsortium.org/XMLSchema/SPIRIT/1685-2009</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>https://www.spiritconsortium.org/XMLSchema/SPIRIT/1685-2009/index.xsd</span><span class='tstring_end'>&#39;</span></span>
    <span class='rbracket'>]</span>
  <span class='kw'>else</span> <span class='comment'># Assume Spirit 1.4 if not
</span>    <span class='id identifier rubyid_schemas'>schemas</span> <span class='op'>=</span> <span class='lbracket'>[</span>
      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>https://www.spiritconsortium.org/XMLSchema/SPIRIT/1.4</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>https://www.spiritconsortium.org/XMLSchema/SPIRIT/1.4/index.xsd</span><span class='tstring_end'>&#39;</span></span>
    <span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_uvm?'>uvm?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:schema</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>1685-2009</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_schemas'>schemas</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>$IREG_GEN/XMLSchema/SPIRIT/VendorExtensions.xsd</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:schema</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>1685-2009</span><span class='tstring_end'>&#39;</span></span> <span class='comment'># Magillem tool uses alternate schema
</span>    <span class='id identifier rubyid_headers'>headers</span> <span class='op'>=</span> <span class='lbrace'>{</span>
      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>xmlns:spirit</span><span class='tstring_end'>&#39;</span></span>       <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>https://www.spiritconsortium.org/XMLSchema/SPIRIT/1685-2009</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>xmlns:xsi</span><span class='tstring_end'>&#39;</span></span>          <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>https://www.w3.org/2001/XMLSchema-instance</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>xsi:schemaLocation</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_schemas'>schemas</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='rbrace'>}</span>
  <span class='kw'>else</span> <span class='comment'># Assume Spirit 1.4 if not
</span>    <span class='id identifier rubyid_headers'>headers</span> <span class='op'>=</span> <span class='lbrace'>{</span>
      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>xmlns:spirit</span><span class='tstring_end'>&#39;</span></span>       <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>https://www.spiritconsortium.org/XMLSchema/SPIRIT/1.4</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>xmlns:xsi</span><span class='tstring_end'>&#39;</span></span>          <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>https://www.w3.org/2001/XMLSchema-instance</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>xsi:schemaLocation</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_schemas'>schemas</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_uvm?'>uvm?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:schema</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>1685-2009</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_headers'>headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>xmlns:vendorExtensions</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>$IREG_GEN/XMLSchema/SPIRIT</span><span class='tstring_end'>&#39;</span></span>
    <span class='comment'># Else:
</span>    <span class='comment'># Do nothing ?
</span>    <span class='comment'># headers[&#39;xmlns:vendorExtensions&#39;] = &#39;$UVM_RGM_HOME/builder/ipxact/schema&#39;
</span>  <span class='kw'>end</span>

  <span class='id identifier rubyid_builder'>builder</span> <span class='op'>=</span> <span class='const'>Nokogiri</span><span class='op'>::</span><span class='const'>XML</span><span class='op'>::</span><span class='const'>Builder</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='label'>encoding:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>UTF-8</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_xml'>xml</span><span class='op'>|</span>
    <span class='id identifier rubyid_spirit'>spirit</span> <span class='op'>=</span> <span class='id identifier rubyid_xml'>xml</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>spirit</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_component'>component</span><span class='lparen'>(</span><span class='id identifier rubyid_headers'>headers</span><span class='rparen'>)</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_vendor'>vendor</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:vendor</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Origen</span><span class='tstring_end'>&#39;</span></span>
      <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_library'>library</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:library</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Origen</span><span class='tstring_end'>&#39;</span></span>
      <span class='comment'># I guess this should really be the register owner&#39;s owner&#39;s name?
</span>      <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='id identifier rubyid_try'>try</span><span class='lparen'>(</span><span class='symbol'>:ip_name</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='id identifier rubyid_owner'>owner</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>::</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span>
      <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_version'>version</span> <span class='id identifier rubyid_try'>try</span><span class='lparen'>(</span><span class='symbol'>:ip_version</span><span class='comma'>,</span> <span class='symbol'>:version</span><span class='comma'>,</span> <span class='symbol'>:revision</span><span class='rparen'>)</span>
      <span class='comment'># The 1685-2009 schema allows for a bus interface.  AMBA3 (slave) supported so far.
</span>      <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:schema</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>1685-2009</span><span class='tstring_end'>&#39;</span></span>
        <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:bus_interface</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>AMBA3</span><span class='tstring_end'>&#39;</span></span>
          <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_busInterfaces'>busInterfaces</span> <span class='kw'>do</span>
            <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_busInterface'>busInterface</span> <span class='kw'>do</span>
              <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Slave</span><span class='tstring_end'>&#39;</span></span>
              <span class='id identifier rubyid_bustype_header'>bustype_header</span> <span class='op'>=</span> <span class='lbrace'>{</span>
                <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>spirit:vendor</span><span class='tstring_end'>&#39;</span></span>  <span class='op'>=&gt;</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:vendor</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Origen</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
                <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>spirit:library</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>amba3</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
                <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>spirit:name</span><span class='tstring_end'>&#39;</span></span>    <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>APB3</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
                <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>spirit:version</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>1.0</span><span class='tstring_end'>&#39;</span></span>
              <span class='rbrace'>}</span>
              <span class='id identifier rubyid_xml'>xml</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>spirit</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_busType'>busType</span> <span class='id identifier rubyid_bustype_header'>bustype_header</span>
              <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_slave'>slave</span> <span class='kw'>do</span>
                <span class='id identifier rubyid_mmapref_header'>mmapref_header</span> <span class='op'>=</span> <span class='lbrace'>{</span>
                  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>spirit:memoryMapRef</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:mmap_ref</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>APB</span><span class='tstring_end'>&#39;</span></span>
                <span class='rbrace'>}</span>
                <span class='id identifier rubyid_xml'>xml</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>spirit</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_memoryMapRef'>memoryMapRef</span> <span class='id identifier rubyid_mmapref_header'>mmapref_header</span>
              <span class='kw'>end</span>
            <span class='kw'>end</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_memoryMaps'>memoryMaps</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_memory_maps'>memory_maps</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_map_name'>map_name</span><span class='comma'>,</span> <span class='id identifier rubyid__map'>_map</span><span class='op'>|</span>
          <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_memoryMap'>memoryMap</span> <span class='kw'>do</span>
            <span class='comment'># Optionally assign memory map name to something other than the module name in Ruby,
</span>            <span class='comment'># default to &#39;RegisterMap&#39;
</span>            <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:mmap_name</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>RegisterMap</span><span class='tstring_end'>&#39;</span></span>
            <span class='id identifier rubyid_address_blocks'>address_blocks</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_domain_name'>domain_name</span><span class='comma'>,</span> <span class='id identifier rubyid__domain'>_domain</span><span class='comma'>,</span> <span class='id identifier rubyid_sub_block'>sub_block</span><span class='op'>|</span>
              <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_addressBlock'>addressBlock</span> <span class='kw'>do</span>
                <span class='comment'># When registers reside at the top level, do not assign an address block name
</span>                <span class='kw'>if</span> <span class='id identifier rubyid_sub_block'>sub_block</span> <span class='op'>==</span> <span class='id identifier rubyid_owner'>owner</span>
                  <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='kw'>nil</span>
                <span class='kw'>else</span>
                  <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='id identifier rubyid_address_block_name'>address_block_name</span><span class='lparen'>(</span><span class='id identifier rubyid_domain_name'>domain_name</span><span class='comma'>,</span> <span class='id identifier rubyid_sub_block'>sub_block</span><span class='rparen'>)</span>
                <span class='kw'>end</span>
                <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_baseAddress'>baseAddress</span> <span class='id identifier rubyid_sub_block'>sub_block</span><span class='period'>.</span><span class='id identifier rubyid_base_address'>base_address</span><span class='period'>.</span><span class='id identifier rubyid_to_hex'>to_hex</span>
                <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_range'>range</span> <span class='id identifier rubyid_range'>range</span><span class='lparen'>(</span><span class='id identifier rubyid_sub_block'>sub_block</span><span class='rparen'>)</span>
                <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_width'>width</span> <span class='id identifier rubyid_width'>width</span><span class='lparen'>(</span><span class='id identifier rubyid_sub_block'>sub_block</span><span class='rparen'>)</span>
                <span class='id identifier rubyid_sub_block'>sub_block</span><span class='period'>.</span><span class='id identifier rubyid_regs'>regs</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_reg'>reg</span><span class='op'>|</span>
                  <span class='comment'># Required for now to ensure that the current value is the reset value
</span>                  <span class='id identifier rubyid_reg'>reg</span><span class='period'>.</span><span class='id identifier rubyid_reset'>reset</span>
                  <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_register'>register</span> <span class='kw'>do</span>
                    <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='id identifier rubyid_name'>name</span>
                    <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_description'>description</span> <span class='id identifier rubyid_try'>try</span><span class='lparen'>(</span><span class='id identifier rubyid_reg'>reg</span><span class='comma'>,</span> <span class='symbol'>:name_full</span><span class='comma'>,</span> <span class='symbol'>:full_name</span><span class='rparen'>)</span>
                    <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_addressOffset'>addressOffset</span> <span class='id identifier rubyid_reg'>reg</span><span class='period'>.</span><span class='id identifier rubyid_offset'>offset</span><span class='period'>.</span><span class='id identifier rubyid_to_hex'>to_hex</span>
                    <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='id identifier rubyid_reg'>reg</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span>
                    <span class='kw'>if</span> <span class='id identifier rubyid_reg'>reg</span><span class='period'>.</span><span class='id identifier rubyid_bits'>bits</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:writable?</span><span class='rparen'>)</span>
                      <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_access'>access</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>read-write</span><span class='tstring_end'>&#39;</span></span>
                    <span class='kw'>else</span>
                      <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_access'>access</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>read-only</span><span class='tstring_end'>&#39;</span></span>
                    <span class='kw'>end</span>
                    <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_reset'>reset</span> <span class='kw'>do</span>
                      <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span> <span class='id identifier rubyid_reg'>reg</span><span class='period'>.</span><span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_to_hex'>to_hex</span>
                      <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_mask'>mask</span> <span class='id identifier rubyid_mask'>mask</span><span class='lparen'>(</span><span class='id identifier rubyid_reg'>reg</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_hex'>to_hex</span>
                    <span class='kw'>end</span>
                    <span class='id identifier rubyid_reg'>reg</span><span class='period'>.</span><span class='id identifier rubyid_named_bits'>named_bits</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_bits'>bits</span><span class='op'>|</span>
                      <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_field'>field</span> <span class='kw'>do</span>
                        <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='id identifier rubyid_name'>name</span>
                        <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_description'>description</span> <span class='id identifier rubyid_try'>try</span><span class='lparen'>(</span><span class='id identifier rubyid_bits'>bits</span><span class='comma'>,</span> <span class='symbol'>:brief_description</span><span class='comma'>,</span> <span class='symbol'>:name_full</span><span class='comma'>,</span> <span class='symbol'>:full_name</span><span class='rparen'>)</span>
                        <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_bitOffset'>bitOffset</span> <span class='id identifier rubyid_bits'>bits</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span>
                        <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_bitWidth'>bitWidth</span> <span class='id identifier rubyid_bits'>bits</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span>
                        <span class='comment'># When exporting to 1685-2009 schema, need to handle special cases (writeOnce),
</span>                        <span class='comment'># modifiedWriteValue, and readAction fields.
</span>                        <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:schema</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>1685-2009</span><span class='tstring_end'>&#39;</span></span>
                          <span class='kw'>if</span> <span class='id identifier rubyid_bits'>bits</span><span class='period'>.</span><span class='id identifier rubyid_writable?'>writable?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_bits'>bits</span><span class='period'>.</span><span class='id identifier rubyid_readable?'>readable?</span>
                            <span class='kw'>if</span> <span class='id identifier rubyid_bits'>bits</span><span class='period'>.</span><span class='id identifier rubyid_access'>access</span> <span class='op'>==</span> <span class='symbol'>:w1</span>
                              <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_access'>access</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>read-writeOnce</span><span class='tstring_end'>&#39;</span></span>
                            <span class='kw'>else</span>
                              <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_access'>access</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>read-write</span><span class='tstring_end'>&#39;</span></span>
                            <span class='kw'>end</span>
                          <span class='kw'>elsif</span> <span class='id identifier rubyid_bits'>bits</span><span class='period'>.</span><span class='id identifier rubyid_writable?'>writable?</span>
                            <span class='kw'>if</span> <span class='id identifier rubyid_bits'>bits</span><span class='period'>.</span><span class='id identifier rubyid_access'>access</span> <span class='op'>==</span> <span class='symbol'>:wo1</span>
                              <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_access'>access</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>writeOnce</span><span class='tstring_end'>&#39;</span></span>
                            <span class='kw'>else</span>
                              <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_access'>access</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>write-only</span><span class='tstring_end'>&#39;</span></span>
                            <span class='kw'>end</span>
                          <span class='kw'>elsif</span> <span class='id identifier rubyid_bits'>bits</span><span class='period'>.</span><span class='id identifier rubyid_readable?'>readable?</span>
                            <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_access'>access</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>read-only</span><span class='tstring_end'>&#39;</span></span>
                          <span class='kw'>end</span>
                          <span class='kw'>if</span> <span class='id identifier rubyid_bits'>bits</span><span class='period'>.</span><span class='id identifier rubyid_readable?'>readable?</span>
                            <span class='kw'>unless</span> <span class='cvar'>@@access_hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_bits'>bits</span><span class='period'>.</span><span class='id identifier rubyid_access'>access</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:read</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                              <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_readAction'>readAction</span> <span class='cvar'>@@access_hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_bits'>bits</span><span class='period'>.</span><span class='id identifier rubyid_access'>access</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:read</span><span class='rbracket'>]</span>
                            <span class='kw'>end</span>
                          <span class='kw'>end</span>
                          <span class='kw'>if</span> <span class='id identifier rubyid_bits'>bits</span><span class='period'>.</span><span class='id identifier rubyid_writable?'>writable?</span>
                            <span class='kw'>unless</span> <span class='cvar'>@@access_hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_bits'>bits</span><span class='period'>.</span><span class='id identifier rubyid_access'>access</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:write</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                              <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_modifiedWriteValue'>modifiedWriteValue</span> <span class='cvar'>@@access_hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_bits'>bits</span><span class='period'>.</span><span class='id identifier rubyid_access'>access</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:write</span><span class='rbracket'>]</span>
                            <span class='kw'>end</span>
                          <span class='kw'>end</span>
                        <span class='kw'>else</span> <span class='comment'># Assume Spirit 1.4 if not
</span>                          <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_access'>access</span> <span class='id identifier rubyid_bits'>bits</span><span class='period'>.</span><span class='id identifier rubyid_access'>access</span>
                        <span class='kw'>end</span>
                        <span class='comment'># HDL paths provide hooks for a testbench to directly manipulate the
</span>                        <span class='comment'># registers without having to go through a bus interface or read/write
</span>                        <span class='comment'># protocol.  Because the hierarchical path to a register block can vary
</span>                        <span class='comment'># greatly between devices, allow the user to provide an abs_path value
</span>                        <span class='comment'># and define &quot;full_reg_path&quot; to assist.
</span>                        <span class='comment'>#
</span>                        <span class='comment'># When registers reside at the top level of the memory map, assume &quot;top&quot;
</span>                        <span class='comment'># for the register path name.  (Need to improve this process in the future.)
</span>                        <span class='kw'>if</span> <span class='id identifier rubyid_reg'>reg</span><span class='period'>.</span><span class='id identifier rubyid_owner'>owner</span><span class='period'>.</span><span class='id identifier rubyid_top_level?'>top_level?</span> <span class='op'>==</span> <span class='kw'>true</span>
                          <span class='id identifier rubyid_regpath'>regpath</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>top</span><span class='tstring_end'>&#39;</span></span>
                        <span class='kw'>else</span>
                          <span class='id identifier rubyid_regpath'>regpath</span> <span class='op'>=</span> <span class='id identifier rubyid_reg'>reg</span><span class='period'>.</span><span class='id identifier rubyid_owner'>owner</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span>
                        <span class='kw'>end</span>
                        <span class='comment'># If :full_reg_path is defined, the :abs_path metadata for a register will
</span>                        <span class='comment'># be used for regpath.  This can be assigned at an address block (sub-block)
</span>                        <span class='comment'># level.
</span>                        <span class='kw'>unless</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:full_reg_path</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>==</span> <span class='kw'>true</span>
                          <span class='id identifier rubyid_regpath'>regpath</span> <span class='op'>=</span> <span class='id identifier rubyid_reg'>reg</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span>
                        <span class='kw'>end</span>
                        <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:schema</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>1685-2009</span><span class='tstring_end'>&#39;</span></span>
                          <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_parameters'>parameters</span> <span class='kw'>do</span>
                            <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_parameter'>parameter</span> <span class='kw'>do</span>
                              <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>_hdlPath_</span><span class='tstring_end'>&#39;</span></span>
                              <span class='comment'># HDL path needs to be to the declared bit field name, NOT to the bus slice
</span>                              <span class='comment'># that Origen&#39;s &quot;abs_path&quot; will yield.  Ex:
</span>                              <span class='comment'>#
</span>                              <span class='comment'># ~~~ ruby
</span>                              <span class='comment'># reg :myreg, 0x0, size: 32 do |reg|
</span>                              <span class='comment'>#   bits 7..4, :bits_high
</span>                              <span class='comment'>#   bits 3..0, :bits_low
</span>                              <span class='comment'># end
</span>                              <span class='comment'># ~~~
</span>                              <span class='comment'>#
</span>                              <span class='comment'># The abs_path to ...regs(:myreg).bits(:bits_low).abs_path will yield
</span>                              <span class='comment'># &quot;myreg.myreg[3:0]&quot;, not &quot;myreg.bits_low&quot;.  This is not an understood path
</span>                              <span class='comment'># in Origen (myreg[3:0] does not exist in either myreg&#39;s RegCollection or BitCollection),
</span>                              <span class='comment'># and does not sync with how RTL would create bits_low[3:0].
</span>                              <span class='comment'># Therefore, use the path to &quot;myreg&quot;&#39;s owner appended with bits.name (bits_low here).
</span>                              <span class='comment'>#
</span>                              <span class='comment'># This can be done in a register or sub_blocks definition by defining register
</span>                              <span class='comment'># metadata for &quot;abs_path&quot;.  If the reg owner&#39;s path weren&#39;t used, but instead the
</span>                              <span class='comment'># reg&#39;s path, that would imply each register was a separate hierarchical path in
</span>                              <span class='comment'># RTL (ex: &quot;top.myblock.regblock.myreg.myreg_bits&quot;), which is normally not the case.
</span>                              <span class='comment'># The most likely path would be &quot;top.myblock.regblock.myreg_bits.
</span>                              <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_regpath'>regpath</span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_bits'>bits</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                            <span class='kw'>end</span>
                          <span class='kw'>end</span>
                        <span class='kw'>end</span>
                        <span class='comment'># C. Hume - Unclear which vendorExtensions should be included by default, if any.
</span>                        <span class='comment'># Future improvment: Allow passing of vendorExtensions enable &amp; value hash/string
</span>                        <span class='comment'># if options[:schema] == &#39;1685-2009&#39;
</span>                        <span class='comment'>#   spirit.vendorExtensions do
</span>                        <span class='comment'>#     vendorext = { &#39;xmlns:vendorExtensions&#39; =&gt; &#39;$UVM_RGM_HOME/builder/ipxact/schema&#39; }
</span>                        <span class='comment'>#     xml[&#39;vendorExtensions&#39;].hdl_path vendorext, &quot;#{reg.path}.#{bits.name}&quot;
</span>                        <span class='comment'>#   end
</span>                        <span class='comment'># end
</span>
                        <span class='comment'># Allow optional inclusion of bit field values and descriptions
</span>                        <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:include_bit_field_values</span><span class='rbracket'>]</span>
                          <span class='kw'>if</span> <span class='id identifier rubyid_bits'>bits</span><span class='period'>.</span><span class='id identifier rubyid_bit_value_descriptions'>bit_value_descriptions</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
                            <span class='id identifier rubyid_bits'>bits</span><span class='period'>.</span><span class='id identifier rubyid_bit_value_descriptions'>bit_value_descriptions</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_val'>val</span><span class='comma'>,</span> <span class='id identifier rubyid_desc'>desc</span><span class='op'>|</span>
                              <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_values'>values</span> <span class='kw'>do</span>
                                <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span> <span class='id identifier rubyid_val'>val</span><span class='period'>.</span><span class='id identifier rubyid_to_hex'>to_hex</span>
                                <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>val_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_val'>val</span><span class='period'>.</span><span class='id identifier rubyid_to_hex'>to_hex</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                                <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_description'>description</span> <span class='id identifier rubyid_desc'>desc</span>
                              <span class='kw'>end</span>
                            <span class='kw'>end</span>
                          <span class='kw'>end</span>
                        <span class='kw'>end</span>
                        <span class='kw'>if</span> <span class='id identifier rubyid_uvm?'>uvm?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:schema</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>1685-2009</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
                          <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_vendorExtensions'>vendorExtensions</span> <span class='kw'>do</span>
                            <span class='id identifier rubyid_xml'>xml</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>vendorExtensions</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_hdl_path'>hdl_path</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_regpath'>regpath</span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_bits'>bits</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                          <span class='kw'>end</span>
                        <span class='kw'>end</span>
                      <span class='kw'>end</span>
                    <span class='kw'>end</span>
                  <span class='kw'>end</span>
                <span class='kw'>end</span>
                <span class='comment'># Unclear whether addressBlock vendor extensions are supported in Spirit 1.4
</span>                <span class='comment'># if uvm?
</span>                <span class='comment'>#  spirit.vendorExtensions do
</span>                <span class='comment'>#    xml[&#39;vendorExtensions&#39;].hdl_path sub_block.path(relative_to: owner)
</span>                <span class='comment'>#  end
</span>                <span class='comment'># end
</span>              <span class='kw'>end</span>
            <span class='kw'>end</span>
            <span class='comment'># Assume byte addressing if not specified
</span>            <span class='kw'>if</span> <span class='id identifier rubyid_owner'>owner</span><span class='period'>.</span><span class='id identifier rubyid_methods'>methods</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='symbol'>:lau</span><span class='rparen'>)</span> <span class='op'>==</span> <span class='kw'>false</span>
              <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_addressUnitBits'>addressUnitBits</span> <span class='int'>8</span>
            <span class='kw'>else</span>
              <span class='id identifier rubyid_spirit'>spirit</span><span class='period'>.</span><span class='id identifier rubyid_addressUnitBits'>addressUnitBits</span> <span class='id identifier rubyid_owner'>owner</span><span class='period'>.</span><span class='id identifier rubyid_lau'>lau</span>
            <span class='kw'>end</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='comment'># When testing with &#39;origen examples&#39;, travis_ci (bash) will end up with empty tags -
</span>  <span class='comment'># &#39;&lt;spirit:description/&gt;&#39; that do not appear on some user&#39;s tshell environments.  To
</span>  <span class='comment'># prevent false errors for this issue, force Nokogiri to use self-closing tags
</span>  <span class='comment'># (&#39;&lt;spirit:description&gt;&lt;/spirit:description&gt;&#39;), but keep the XML formatted for readability.
</span>  <span class='comment'># All tags with no content will appear as &#39;&lt;spirit:tag_name&gt;&lt;/spirit:tag_name&gt;&#39;.
</span>  <span class='comment'>#
</span>  <span class='id identifier rubyid_builder'>builder</span><span class='period'>.</span><span class='id identifier rubyid_to_xml'>to_xml</span><span class='lparen'>(</span><span class='label'>save_with:</span> <span class='const'>Nokogiri</span><span class='op'>::</span><span class='const'>XML</span><span class='op'>::</span><span class='const'>Node</span><span class='op'>::</span><span class='const'>SaveOptions</span><span class='op'>::</span><span class='const'>NO_EMPTY_TAGS</span> <span class='op'>|</span>
                            <span class='const'>Nokogiri</span><span class='op'>::</span><span class='const'>XML</span><span class='op'>::</span><span class='const'>Node</span><span class='op'>::</span><span class='const'>SaveOptions</span><span class='op'>::</span><span class='const'>FORMAT</span><span class='rparen'>)</span>
  <span class='comment'># builder.to_xml
</span><span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Thu Dec 13 03:32:57 2018 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.16 (ruby-2.5.1).
</div>

    </div>
  </body>
</html>